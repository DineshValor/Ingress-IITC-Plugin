// ==UserScript==
// @id             iitc_plugin_MoreFields2
// @name           RW-MoreFields
// @author         Hevne
// @category       Utilities
// @version        1.9.0
// @downloadURL    https://iitc.willbe.blue/download/7785/SCTU-9ws4W-hAz1UFKgZaTYxZDU2MGE1M2M2OTM2MjNmOTE4ZjFkY2FkZjY3Y2NiYTAxNjhkOTdhYjEyNzI0OTUyMmMzMDdlZGI3NTAxZDkaROpaA-WXcvd3Y0chD8KkveJJUoDH7ILVTT29UOSluFsfPHaZ31d0hLVIocjp-5ZnQcm4msRg0fHaFeGIMbp77O4NCvsSofZjlU9-kqB2mg==/iitc_plugin_MoreFields2.user.js
// @updateURL      https://iitc.willbe.blue/update-header/7785/h6Of2sU-C67jwfWJ44GFwGY5MmE2MTM2NGE1ZmI1NmRiYjFmYjQ4NzBjNTIyYjJjN2NkNmI4ZjMwNmVjZmQyMmFjYzhkZDA5M2ZkNmY5NTJyb66Zc9ELXZYUVJNd1foNOCuCFkGXPNHCMp-D9p6PHO4JPL3X7nReTkYFtJfvXjB1BSvXHb7X7c3DBNesX-nVzBBa1pLIT0_9LIyS4h0Kng==/iitc_plugin_MoreFields2.user.js
// @description    Generate multilayer fields by a baslink and an area.
// @match          *://intel.ingress.com/*
// @match          *://intel-x.ingress.com/*
// @match          *://*.ingress.com/mission/*
// @grant          none
// ==/UserScript==



 
 /**
  * v1.9
  * - Calculate Blockers
  * - LazyFeet: a kind of max-field search
  * - fix link-field skipped one origin portal
  * 
  * v1.8.1
  * - HCF: status message if no solution is possible
  *  
  * v1.8
  * - LinkStar
  * - Homogeneous Field search
  * 
  * v1.7
  * - multifields: polygon selection (if >3 drawtool polygons) ... all credits to maxngrss
  * 
  * v1.6.2
  * - Layer select on RESWUE export
  * - Fix polygon-portal-scanner (didn't counted all portals when loading)
  * 
  * v1.6.1
  * - IITC.ME (0.26) LinkFields wasn't working (missing default marker image)
  * - Show "0%" on process start
  * 
  * v1.6
  * - LinkFields
  * - Changed Tab-Layout to Pages
  * - Added a "Welcome" Page with some basic descriptions
  * - Backlinks is now page option and not a general one
  * - Fix corner portals of polygons were ignored
  * - Fix some issues in polygon portal detection (it's about "iitc map load finished" + errors )
  * 
  * v1.5
  * - FanFields
  * - Show portal/link order
  * - Show required Key count
  * - Fix mobile build
  * - Fix IITC-Button startup
  * - Fix Morefields set base portal (it failed sometime to read current selected portal)
  * - Fix geodesic variation (FanField revealed a discrepance when testing on which side of a link a portal is)
  * 
  * v1.4.1
  * - fix RESWUE tool menu link
  * 
  * v1.4
  * - backlinks
  * - options for multifield creation
  * - remember options and selections (except polygons)
  * - polygon click jumps to missing/not scanned tile
  * - fix problem with narrow field in "Multi" mode
  * - fix progressbar
  * 
  * v1.3
  * - Multi-layer search
  * - reworked portal/polygon scanner
  * 
  * v1.2
  * - use corect "earth-math" instead of simple triogemtry
  * (this fixes some generated crosslinks in larger fields under some circumstances)
  * 
  * v1.1.1
  * - Fix init error (accidently added experimental stuff)
  * 
  * v1.1
  * - Fix calculation if areas are on both sides of the base link
  * - Use Drawtool Marker to exclude portals
  * - Don't block baselink portals interaction
  * 
  * v1.0
  */
 function wrapper(SCRIPT_INFO) {
 /*! For license information please see iitc_plugin_MoreFields2.user.js.LICENSE.txt */
 (()=>{var t={56:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},72:t=>{"use strict";var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var n={},o=[],a=0;a<t.length;a++){var l=t[a],h=s.base?l[0]+s.base:l[0],d=n[h]||0,c="".concat(h," ").concat(d);n[h]=d+1;var u=i(c),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)e[u].references++,e[u].updater(f);else{var p=r(f,s);s.byIndex=a,e.splice(a,0,{identifier:c,updater:p,references:1})}o.push(c)}return o}function r(t,e){var i=e.domAPI(e);i.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var n=s(t=t||[],r=r||{});return function(t){t=t||[];for(var o=0;o<n.length;o++){var a=i(n[o]);e[a].references--}for(var l=s(t,r),h=0;h<n.length;h++){var d=i(n[h]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}n=l}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i}).join("")},e.i=function(t,i,s,r,n){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var h=0;h<t.length;h++){var d=[].concat(t[h]);s&&o[d[0]]||(void 0!==n&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=n),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),e.push(d))}},e}},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{"use strict";t.exports=function(t){return t[1]}},616:(t,e,i)=>{var s=i(710),r=t.exports;r.get=function(){return window.plugin.reswue2},r.selectedOP=function(){return window.plugin.reswue2&&window.plugin.reswue2.operations.current()},r.isInstalled=function(){return void 0!==window.plugin.reswue2},r.requiredVersion=function(t){return window.plugin.reswue2&&window.plugin.reswue2.checkVersion&&window.plugin.reswue2.checkVersion(t)},r.testVersion=function(){return r.requiredVersion("2.42.1")},r.registerAddon=function(t){if("string"!=typeof t.name||"function"!=typeof t.action)throw"registerAddon has wrong arguments";const e=r.get();e&&e.registerAddon&&r.get().registerAddon(t)},r.readExtraSetting=async(t,e)=>{const i=[];let r,n=0;for(;void 0!==(r=t.settings.get(`${e}_${n++}`));)i.push(r);const o=i.join("");if(!o)return;const a=new s,l=await a.loadAsync(o,{base64:!0});if(!l)return;const h=l.file(`${e}.json`);if(!h)return;const d=await h.async("string");return JSON.parse(d)},r.writeExtraSetting=async(t,e,i)=>{const r=new s;r.file(`${e}.json`,JSON.stringify(i));const o=await r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}),a=n(o,64e3);for(const[i,s]of a.entries())await t.updateSetting(`${e}_${i}`,JSON.stringify(s))};const n=(t,e=6e4)=>{const i=[];for(let s=0;s<t.length;s+=e)i.push(t.slice(s,s+e));return i};r.deleteExtraSetting=async(t,e)=>{let i=0;for(;void 0!==t.settings.get(`${e}_${i}`);)await t.deleteSetting(`${e}_${i}`),i++}},659:t=>{"use strict";var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},707:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var s=i(601),r=i.n(s),n=i(314),o=i.n(n)()(r());o.push([t.id,"#dialog-moreFields p{margin:0}#dialog-moreFields input{vertical-align:middle}#dialog-moreFields #pages{margin-bottom:2px;text-align:center;width:99%}#dialog-moreFields .sectionButton{width:60%}#dialog-moreFields .tabcontainer{border:1px solid #ffce00;min-height:8em;padding:.5em}#dialog-moreFields .tabcontainer div{margin-bottom:.3em}#dialog-moreFields button:disabled{border-color:#957a0c;color:#887b5d}#dialog-moreFields span{margin-left:.4em}#dialog-moreFields .portal{margin-left:1em}#dialog-moreFields .exportbox{border:1px solid #ffce00;margin-top:1em;padding:.5em}#dialog-moreFields .exportbox .copyfield{float:right;width:40%}#dialog-moreFields .exportbox #fieldsfound{width:50%}#dialog-moreFields .exportbox #keylist{word-wrap:break-word}#dialog-moreFields .exportbox #alerts{border:1px solid #ffcc0050;height:1em;margin-bottom:1em}#dialog-moreFields .exportbox .mfprocessbar{border:1px solid #20a8b1;display:none;float:right;padding:1px;position:relative;top:-1.3em;width:45%}#dialog-moreFields .exportbox .mfprocessbar .mftext{position:absolute;text-align:center;width:100%;z-index:1}#dialog-moreFields .exportbox .mfprocessbar .mfbar{background-color:#20a8b1;display:block;height:1em;margin:0}#dialog-moreFields #showoptions{display:block}#dialog-moreFields #showoptions:hover{text-decoration:none}#dialog-moreFields .myshowbutton{border-color:transparent transparent transparent #faba17;border-style:solid;border-width:7px 0 7px 14px;display:inline-block;height:0;left:5px;position:relative;top:7px;width:0}#dialog-moreFields .myhidebutton{border-color:transparent #faba17 transparent transparent;border-style:solid;border-width:8px 16px 8px 0;float:right;height:0;width:0}#dialog-moreFields .quickhelpbutton{background-color:#feb22a;border-radius:100%;box-shadow:inset -1px -1px 1px 0 rgba(0,0,0,.25);color:#000;display:inline-block;font-size:10px;height:12px;line-height:12px;margin-left:.5em;text-align:center;text-decoration:none;width:12px}#dialog-moreFields .messagepopup{background-color:#266c8e;border:1px solid #999;cursor:default;display:none;margin-top:15px;padding:15px 15px 10px;position:fixed;text-align:left;width:380px;z-index:50}#dialog-moreFields .messagepopup ol{margin:7px}#dialog-moreFields .messagepopup div{margin-bottom:1em}#dialog-moreFields .withPolygonOrder .uparrow{background:#72757b;border-color:transparent transparent #ffce00;border-style:solid;border-width:0 8px 8px;display:block;float:right;height:0;min-width:auto;width:0}#dialog-moreFields .withPolygonOrder .downarrow{background:#72757b;border-color:#ffce00 transparent transparent;border-style:solid;border-width:8px 8px 0;display:block;float:right;height:0;min-width:auto;width:0}#dialog-moreFields .downarrow,#dialog-moreFields .uparrow{display:none}#dialog-moreFields .morefield_label{border-left:thin dotted red;color:#ffb;font-size:11px;height:49px;line-height:13px;overflow:hidden;padding:15px 2px 2px;pointer-events:none;text-align:left;text-shadow:1px 1px #000,1px -1px #000,-1px 1px #000,-1px -1px #000,0 0 5px #000;vertical-align:bottom;width:100px}#dialog-moreFields #errortext{color:red;font-weight:700;text-align:center}#dialog-moreFields #lfinfo{margin-left:.4em}#dialog-moreFields .polygonSelectorbox{border:1px solid #ffce00;height:7.5em;margin-top:1em;overflow-y:scroll;padding:.5em}",""]);const a=o},710:(t,e,i)=>{t.exports=function t(e,i,s){function r(o,a){if(!i[o]){if(!e[o]){if(n)return n(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[o]={exports:{}};e[o][0].call(h.exports,function(t){return r(e[o][1][t]||t)},h,h.exports,t,e,i,s)}return i[o].exports}for(var n=void 0,o=0;o<s.length;o++)r(s[o]);return r}({1:[function(t,e,i){"use strict";var s=t("./utils"),r=t("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,r,o,a,l,h,d=[],c=0,u=t.length,f=u,p="string"!==s.getTypeOf(t);c<t.length;)f=u-c,r=p?(e=t[c++],i=c<u?t[c++]:0,c<u?t[c++]:0):(e=t.charCodeAt(c++),i=c<u?t.charCodeAt(c++):0,c<u?t.charCodeAt(c++):0),o=e>>2,a=(3&e)<<4|i>>4,l=1<f?(15&i)<<2|r>>6:64,h=2<f?63&r:64,d.push(n.charAt(o)+n.charAt(a)+n.charAt(l)+n.charAt(h));return d.join("")},i.decode=function(t){var e,i,s,o,a,l,h=0,d=0,c="data:";if(t.substr(0,c.length)===c)throw new Error("Invalid base64 input, it looks like a data url.");var u,f=3*(t=t.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(t.charAt(t.length-1)===n.charAt(64)&&f--,t.charAt(t.length-2)===n.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(u=r.uint8array?new Uint8Array(0|f):new Array(0|f);h<t.length;)e=n.indexOf(t.charAt(h++))<<2|(o=n.indexOf(t.charAt(h++)))>>4,i=(15&o)<<4|(a=n.indexOf(t.charAt(h++)))>>2,s=(3&a)<<6|(l=n.indexOf(t.charAt(h++))),u[d++]=e,64!==a&&(u[d++]=i),64!==l&&(u[d++]=s);return u}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";var s=t("./external"),r=t("./stream/DataWorker"),n=t("./stream/Crc32Probe"),o=t("./stream/DataLengthProbe");function a(t,e,i,s,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=s,this.compressedContent=r}a.prototype={getContentWorker:function(){var t=new r(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new r(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(t,e,i){return t.pipe(new n).pipe(new o("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new o("compressedSize")).withStreamInfo("compression",e)},e.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var s=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";var s=t("./utils"),r=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==s.getTypeOf(t)?function(t,e,i,s){var n=r,o=s+i;t^=-1;for(var a=s;a<o;a++)t=t>>>8^n[255&(t^e[a])];return-1^t}(0|e,t,t.length,0):function(t,e,i,s){var n=r,o=s+i;t^=-1;for(var a=s;a<o;a++)t=t>>>8^n[255&(t^e.charCodeAt(a))];return-1^t}(0|e,t,t.length,0):0}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var s=null;s="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:s}},{lie:37}],7:[function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako"),n=t("./utils"),o=t("./stream/GenericWorker"),a=s?"uint8array":"array";function l(t,e){o.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}i.magic="\b\0",n.inherits(l,o),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(n.transformTo(a,t.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(t){return new l("Deflate",t)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,i){"use strict";function s(t,e){var i,s="";for(i=0;i<e;i++)s+=String.fromCharCode(255&t),t>>>=8;return s}function r(t,e,i,r,o,d){var c,u,f=t.file,p=t.compression,g=d!==a.utf8encode,m=n.transformTo("string",d(f.name)),w=n.transformTo("string",a.utf8encode(f.name)),y=f.comment,b=n.transformTo("string",d(y)),v=n.transformTo("string",a.utf8encode(y)),k=w.length!==f.name.length,_=v.length!==y.length,x="",S="",P="",L=f.dir,A=f.date,E={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(E.crc32=t.crc32,E.compressedSize=t.compressedSize,E.uncompressedSize=t.uncompressedSize);var C=0;e&&(C|=8),g||!k&&!_||(C|=2048);var I=0,T=0;L&&(I|=16),"UNIX"===o?(T=798,I|=function(t,e){var i=t;return t||(i=e?16893:33204),(65535&i)<<16}(f.unixPermissions,L)):(T=20,I|=function(t){return 63&(t||0)}(f.dosPermissions)),c=A.getUTCHours(),c<<=6,c|=A.getUTCMinutes(),c<<=5,c|=A.getUTCSeconds()/2,u=A.getUTCFullYear()-1980,u<<=4,u|=A.getUTCMonth()+1,u<<=5,u|=A.getUTCDate(),k&&(S=s(1,1)+s(l(m),4)+w,x+="up"+s(S.length,2)+S),_&&(P=s(1,1)+s(l(b),4)+v,x+="uc"+s(P.length,2)+P);var O="";return O+="\n\0",O+=s(C,2),O+=p.magic,O+=s(c,2),O+=s(u,2),O+=s(E.crc32,4),O+=s(E.compressedSize,4),O+=s(E.uncompressedSize,4),O+=s(m.length,2),O+=s(x.length,2),{fileRecord:h.LOCAL_FILE_HEADER+O+m+x,dirRecord:h.CENTRAL_FILE_HEADER+s(T,2)+O+s(b.length,2)+"\0\0\0\0"+s(I,4)+s(r,4)+m+x+b}}var n=t("../utils"),o=t("../stream/GenericWorker"),a=t("../utf8"),l=t("../crc32"),h=t("../signature");function d(t,e,i,s){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=s,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(d,o),d.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,s=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,o.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-s-1))/i:100}}))},d.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=r(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=r(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:function(t){return h.DATA_DESCRIPTOR+s(t.crc32,4)+s(t.compressedSize,4)+s(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,r=function(t,e,i,r,o){var a=n.transformTo("string",o(r));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(t,2)+s(t,2)+s(e,4)+s(i,4)+s(a.length,2)+a}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},d.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(t){var e=this._sources;if(!o.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},d.prototype.lock=function(){o.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var s=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(t,e,i){var n=new r(e.streamFiles,i,e.platform,e.encodeFileName),o=0;try{t.forEach(function(t,i){o++;var r=function(t,e){var i=t||e,r=s[i];if(!r)throw new Error(i+" is not a valid compression method !");return r}(i.options.compression,e.compression),a=i.options.compressionOptions||e.compressionOptions||{},l=i.dir,h=i.date;i._compressWorker(r,a).withStreamInfo("file",{name:t,dir:l,date:h,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(n)}),n.entriesCount=o}catch(t){n.error(t)}return n}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new s;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(t,e){return(new s).loadAsync(t,e)},s.external=t("./external"),e.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";var s=t("./utils"),r=t("./external"),n=t("./utf8"),o=t("./zipEntries"),a=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function h(t){return new r.Promise(function(e,i){var s=t.decompressed.getContentWorker().pipe(new a);s.on("error",function(t){i(t)}).on("end",function(){s.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var i=this;return e=s.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),l.isNode&&l.isStream(t)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var i=new o(e);return i.load(t),i}).then(function(t){var i=[r.Promise.resolve(t)],s=t.files;if(e.checkCRC32)for(var n=0;n<s.length;n++)i.push(h(s[n]));return r.Promise.all(i)}).then(function(t){for(var r=t.shift(),n=r.files,o=0;o<n.length;o++){var a=n[o],l=a.fileNameStr,h=s.resolve(a.fileNameStr);i.file(h,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders}),a.dir||(i.file(h).unsafeOriginalName=l)}return r.zipComment.length&&(i.comment=r.zipComment),i})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";var s=t("../utils"),r=t("../stream/GenericWorker");function n(t,e){r.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}s.inherits(n,r),n.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},n.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";var s=t("readable-stream").Readable;function r(t,e,i){s.call(this,e),this._helper=t;var r=this;t.on("data",function(t,e){r.push(t)||r._helper.pause(),i&&i(e)}).on("error",function(t){r.emit("error",t)}).on("end",function(){r.push(null)})}t("../utils").inherits(r,s),r.prototype._read=function(){this._helper.resume()},e.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";function s(t,e,i){var s,r=n.getTypeOf(e),a=n.extend(i||{},l);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(t=g(t)),a.createFolders&&(s=p(t))&&m.call(this,s,!0);var c="string"===r&&!1===a.binary&&!1===a.base64;i&&void 0!==i.binary||(a.binary=!c),(e instanceof h&&0===e.uncompressedSize||a.dir||!e||0===e.length)&&(a.base64=!1,a.binary=!0,e="",a.compression="STORE",r="string");var w=null;w=e instanceof h||e instanceof o?e:u.isNode&&u.isStream(e)?new f(t,e):n.prepareContent(t,e,a.binary,a.optimizedBinaryString,a.base64);var y=new d(t,w,a);this.files[t]=y}var r=t("./utf8"),n=t("./utils"),o=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),l=t("./defaults"),h=t("./compressedObject"),d=t("./zipObject"),c=t("./generate"),u=t("./nodejsUtils"),f=t("./nodejs/NodejsStreamInputAdapter"),p=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},g=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},m=function(t,e){return e=void 0!==e?e:l.createFolders,t=g(t),this.files[t]||s.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function w(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,s;for(e in this.files)s=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,s)},filter:function(t){var e=[];return this.forEach(function(i,s){t(i,s)&&e.push(s)}),e},file:function(t,e,i){if(1!==arguments.length)return t=this.root+t,s.call(this,t,e,i),this;if(w(t)){var r=t;return this.filter(function(t,e){return!e.dir&&r.test(t)})}var n=this.files[this.root+t];return n&&!n.dir?n:null},folder:function(t){if(!t)return this;if(w(t))return this.filter(function(e,i){return i.dir&&t.test(e)});var e=this.root+t,i=m.call(this,e),s=this.clone();return s.root=i.name,s},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter(function(e,i){return i.name.slice(0,t.length)===t}),s=0;s<i.length;s++)delete this.files[i[s].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=n.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");n.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var s=i.comment||this.comment||"";e=c.generateWorker(this,i,s)}catch(t){(e=new o("error")).error(t)}return new a(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){"use strict";e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";var s=t("./DataReader");function r(t){s.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(r,s),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),s=t.charCodeAt(2),r=t.charCodeAt(3),n=this.length-4;0<=n;--n)if(this.data[n]===e&&this.data[n+1]===i&&this.data[n+2]===s&&this.data[n+3]===r)return n-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),s=t.charCodeAt(2),r=t.charCodeAt(3),n=this.readData(4);return e===n[0]&&i===n[1]&&s===n[2]&&r===n[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";var s=t("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return s.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,i){"use strict";var s=t("./Uint8ArrayReader");function r(t){s.call(this,t)}t("../utils").inherits(r,s),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";var s=t("./DataReader");function r(t){s.call(this,t)}t("../utils").inherits(r,s),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";var s=t("./ArrayReader");function r(t){s.call(this,t)}t("../utils").inherits(r,s),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var s=t("../utils"),r=t("../support"),n=t("./ArrayReader"),o=t("./StringReader"),a=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=s.getTypeOf(t);return s.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new a(t):r.uint8array?new l(s.transformTo("uint8array",t)):new n(s.transformTo("array",t)):new o(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";var s=t("./GenericWorker"),r=t("../utils");function n(t){s.call(this,"ConvertWorker to "+t),this.destType=t}r.inherits(n,s),n.prototype.processChunk=function(t){this.push({data:r.transformTo(this.destType,t.data),meta:t.meta})},e.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";var s=t("./GenericWorker"),r=t("../crc32");function n(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(n,s),n.prototype.processChunk=function(t){this.streamInfo.crc32=r(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";var s=t("../utils"),r=t("./GenericWorker");function n(t){r.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}s.inherits(n,r),n.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}r.prototype.processChunk.call(this,t)},e.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";var s=t("../utils"),r=t("./GenericWorker");function n(t){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=s.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}s.inherits(n,r),n.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function s(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=s},{}],29:[function(t,e,i){"use strict";var s=t("../utils"),r=t("./ConvertWorker"),n=t("./GenericWorker"),o=t("../base64"),a=t("../support"),l=t("../external"),h=null;if(a.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function d(t,e){return new l.Promise(function(i,r){var n=[],a=t._internalType,l=t._outputType,h=t._mimeType;t.on("data",function(t,i){n.push(t),e&&e(i)}).on("error",function(t){n=[],r(t)}).on("end",function(){try{var t=function(t,e,i){switch(t){case"blob":return s.newBlob(s.transformTo("arraybuffer",e),i);case"base64":return o.encode(e);default:return s.transformTo(t,e)}}(l,function(t,e){var i,s=0,r=null,n=0;for(i=0;i<e.length;i++)n+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(r=new Uint8Array(n),i=0;i<e.length;i++)r.set(e[i],s),s+=e[i].length;return r;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(a,n),h);i(t)}catch(t){r(t)}n=[]}).resume()})}function c(t,e,i){var o=e;switch(e){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=e,this._mimeType=i,s.checkSupport(o),this._worker=t.pipe(new r(o)),t.lock()}catch(t){this._worker=new n("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return d(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,function(t){e.call(i,t.data,t.meta)}):this._worker.on(t,function(){s.delay(e,arguments,i)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(s.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=0===new Blob([s],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(s),i.blob=0===r.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";for(var s=t("./utils"),r=t("./support"),n=t("./nodejsUtils"),o=t("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function h(){o.call(this,"utf-8 decode"),this.leftOver=null}function d(){o.call(this,"utf-8 encode")}a[254]=a[254]=1,i.utf8encode=function(t){return r.nodebuffer?n.newBufferFrom(t,"utf-8"):function(t){var e,i,s,n,o,a=t.length,l=0;for(n=0;n<a;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(s=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=r.uint8array?new Uint8Array(l):new Array(l),n=o=0;o<l;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(s=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),i<128?e[o++]=i:(i<2048?e[o++]=192|i>>>6:(i<65536?e[o++]=224|i>>>12:(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63),e[o++]=128|i>>>6&63),e[o++]=128|63&i);return e}(t)},i.utf8decode=function(t){return r.nodebuffer?s.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,i,r,n,o=t.length,l=new Array(2*o);for(e=i=0;e<o;)if((r=t[e++])<128)l[i++]=r;else if(4<(n=a[r]))l[i++]=65533,e+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&e<o;)r=r<<6|63&t[e++],n--;1<n?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),s.applyFromCharCode(l)}(t=s.transformTo(r.uint8array?"uint8array":"array",t))},s.inherits(h,o),h.prototype.processChunk=function(t){var e=s.transformTo(r.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var n=e;(e=new Uint8Array(n.length+this.leftOver.length)).set(this.leftOver,0),e.set(n,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var o=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+a[t[i]]>e?i:e}(e),l=e;o!==e.length&&(r.uint8array?(l=e.subarray(0,o),this.leftOver=e.subarray(o,e.length)):(l=e.slice(0,o),this.leftOver=e.slice(o,e.length))),this.push({data:i.utf8decode(l),meta:t.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,o),d.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){"use strict";var s=t("./support"),r=t("./base64"),n=t("./nodejsUtils"),o=t("./external");function a(t){return t}function l(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}t("setimmediate"),i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob([t],{type:e})}catch(i){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return s.append(t),s.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(t,e,i){var s=[],r=0,n=t.length;if(n<=i)return String.fromCharCode.apply(null,t);for(;r<n;)"array"===e||"nodebuffer"===e?s.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+i,n)))):s.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+i,n)))),r+=i;return s.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&1===String.fromCharCode.apply(null,n.allocBuffer(1)).length}catch(t){return!1}}()}};function d(t){var e=65536,s=i.getTypeOf(t),r=!0;if("uint8array"===s?r=h.applyCanBeUsed.uint8array:"nodebuffer"===s&&(r=h.applyCanBeUsed.nodebuffer),r)for(;1<e;)try{return h.stringifyByChunk(t,s,e)}catch(t){e=Math.floor(e/2)}return h.stringifyByChar(t)}function c(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}i.applyFromCharCode=d;var u={};u.string={string:a,array:function(t){return l(t,new Array(t.length))},arraybuffer:function(t){return u.string.uint8array(t).buffer},uint8array:function(t){return l(t,new Uint8Array(t.length))},nodebuffer:function(t){return l(t,n.allocBuffer(t.length))}},u.array={string:d,array:a,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return n.newBufferFrom(t)}},u.arraybuffer={string:function(t){return d(new Uint8Array(t))},array:function(t){return c(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:a,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return n.newBufferFrom(new Uint8Array(t))}},u.uint8array={string:d,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:a,nodebuffer:function(t){return n.newBufferFrom(t)}},u.nodebuffer={string:d,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return u.nodebuffer.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:a},i.transformTo=function(t,e){if(e=e||"",!t)return e;i.checkSupport(t);var s=i.getTypeOf(e);return u[s][t](e)},i.resolve=function(t){for(var e=t.split("/"),i=[],s=0;s<e.length;s++){var r=e[s];"."===r||""===r&&0!==s&&s!==e.length-1||(".."===r?i.pop():i.push(r))}return i.join("/")},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":s.nodebuffer&&n.isBuffer(t)?"nodebuffer":s.uint8array&&t instanceof Uint8Array?"uint8array":s.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!s[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,s="";for(i=0;i<(t||"").length;i++)s+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return s},i.delay=function(t,e,i){setImmediate(function(){t.apply(i||null,e||[])})},i.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,n,a,h){return o.Promise.resolve(e).then(function(t){return s.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new o.Promise(function(e,i){var s=new FileReader;s.onload=function(t){e(t.target.result)},s.onerror=function(t){i(t.target.error)},s.readAsArrayBuffer(t)}):t}).then(function(e){var d=i.getTypeOf(e);return d?("arraybuffer"===d?e=i.transformTo("uint8array",e):"string"===d&&(h?e=r.decode(e):n&&!0!==a&&(e=function(t){return l(t,s.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):o.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,e,i){"use strict";var s=t("./reader/readerFor"),r=t("./utils"),n=t("./signature"),o=t("./zipEntry"),a=t("./support");function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(e)+", expected "+r.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var s=this.reader.readString(4)===e;return this.reader.setIndex(i),s},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=a.uint8array?"uint8array":"array",i=r.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,s=this.zip64EndOfCentralSize-44;0<s;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(t=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var s=e-i;if(0<s)this.isSignature(e,n.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(s<0)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(t){this.reader=s(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";var s=t("./reader/readerFor"),r=t("./utils"),n=t("./compressedObject"),o=t("./crc32"),a=t("./utf8"),l=t("./compressions"),h=t("./support");function d(t,e){this.options=t,this.loadOptions=e}d.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(Object.prototype.hasOwnProperty.call(l,e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var t=s(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(t){var e,i,s,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<r;)e=t.readInt(2),i=t.readInt(2),s=t.readData(i),this.extraFields[e]={id:e,length:i,value:s};t.setIndex(r)},handleUTF8:function(){var t=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=r.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var s=this.findExtraFieldUnicodeComment();if(null!==s)this.fileCommentStr=s;else{var n=r.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=s(t.value);return 1!==e.readInt(1)||o(this.fileName)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=s(t.value);return 1!==e.readInt(1)||o(this.fileComment)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null}},e.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";function s(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var r=t("./stream/StreamHelper"),n=t("./stream/DataWorker"),o=t("./utf8"),a=t("./compressedObject"),l=t("./stream/GenericWorker");s.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var s="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var n=!this._dataBinary;n&&!s&&(e=e.pipe(new o.Utf8EncodeWorker)),!n&&s&&(e=e.pipe(new o.Utf8DecodeWorker))}catch(t){(e=new l("error")).error(t)}return new r(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new n(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<h.length;c++)s.prototype[h[c]]=d;e.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,s){(function(t){"use strict";var i,s,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var n=0,o=new r(d),a=t.document.createTextNode("");o.observe(a,{characterData:!0}),i=function(){a.data=n=++n%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){d(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(d,0)};else{var l=new t.MessageChannel;l.port1.onmessage=d,i=function(){l.port2.postMessage(0)}}var h=[];function d(){var t,e;s=!0;for(var i=h.length;i;){for(e=h,h=[],t=-1;++t<i;)e[t]();i=h.length}s=!1}e.exports=function(t){1!==h.push(t)||s||i()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,i){"use strict";var s=t("immediate");function r(){}var n={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==r&&f(this,t)}function d(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function c(t,e,i){s(function(){var s;try{s=e(i)}catch(s){return n.reject(t,s)}s===t?n.reject(t,new TypeError("Cannot resolve promise with itself")):n.resolve(t,s)})}function u(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function f(t,e){var i=!1;function s(e){i||(i=!0,n.reject(t,e))}function r(e){i||(i=!0,n.resolve(t,e))}var o=p(function(){e(r,s)});"error"===o.status&&s(o.value)}function p(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=h).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(i){return e.resolve(t()).then(function(){return i})},function(i){return e.resolve(t()).then(function(){throw i})})},h.prototype.catch=function(t){return this.then(null,t)},h.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===o)return this;var i=new this.constructor(r);return this.state!==l?c(i,this.state===a?t:e,this.outcome):this.queue.push(new d(i,t,e)),i},d.prototype.callFulfilled=function(t){n.resolve(this.promise,t)},d.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},d.prototype.callRejected=function(t){n.reject(this.promise,t)},d.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},n.resolve=function(t,e){var i=p(u,e);if("error"===i.status)return n.reject(t,i.value);var s=i.value;if(s)f(t,s);else{t.state=a,t.outcome=e;for(var r=-1,o=t.queue.length;++r<o;)t.queue[r].callFulfilled(e)}return t},n.reject=function(t,e){t.state=o,t.outcome=e;for(var i=-1,s=t.queue.length;++i<s;)t.queue[i].callRejected(e);return t},h.resolve=function(t){return t instanceof this?t:n.resolve(new this(r),t)},h.reject=function(t){var e=new this(r);return n.reject(e,t)},h.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var o=new Array(i),a=0,l=-1,h=new this(r);++l<i;)d(t[l],l);return h;function d(t,r){e.resolve(t).then(function(t){o[r]=t,++a!==i||s||(s=!0,n.resolve(h,o))},function(t){s||(s=!0,n.reject(h,t))})}},h.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var o,a=-1,l=new this(r);++a<i;)o=t[a],e.resolve(o).then(function(t){s||(s=!0,n.resolve(l,t))},function(t){s||(s=!0,n.reject(l,t))});return l}},{immediate:36}],38:[function(t,e,i){"use strict";var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,i){"use strict";var s=t("./zlib/deflate"),r=t("./utils/common"),n=t("./utils/strings"),o=t("./zlib/messages"),a=t("./zlib/zstream"),l=Object.prototype.toString,h=0,d=-1,c=0,u=8;function f(t){if(!(this instanceof f))return new f(t);this.options=r.assign({level:d,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==h)throw new Error(o[i]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?n.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=s.deflateSetDictionary(this.strm,p))!==h)throw new Error(o[i]);this._dict_set=!0}}function p(t,e){var i=new f(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}f.prototype.push=function(t,e){var i,o,a=this.strm,d=this.options.chunkSize;if(this.ended)return!1;o=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=n.string2buf(t):"[object ArrayBuffer]"===l.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(d),a.next_out=0,a.avail_out=d),1!==(i=s.deflate(a,o))&&i!==h)return this.onEnd(i),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(n.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==i);return 4===o?(i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==o||(this.onEnd(h),!(a.avail_out=0))},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=f,i.deflate=p,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,i){"use strict";var s=t("./zlib/inflate"),r=t("./utils/common"),n=t("./utils/strings"),o=t("./zlib/constants"),a=t("./zlib/messages"),l=t("./zlib/zstream"),h=t("./zlib/gzheader"),d=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=s.inflateInit2(this.strm,e.windowBits);if(i!==o.Z_OK)throw new Error(a[i]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function u(t,e){var i=new c(e);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}c.prototype.push=function(t,e){var i,a,l,h,c,u,f=this.strm,p=this.options.chunkSize,g=this.options.dictionary,m=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof t?f.input=n.binstring2buf(t):"[object ArrayBuffer]"===d.call(t)?f.input=new Uint8Array(t):f.input=t,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new r.Buf8(p),f.next_out=0,f.avail_out=p),(i=s.inflate(f,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&g&&(u="string"==typeof g?n.string2buf(g):"[object ArrayBuffer]"===d.call(g)?new Uint8Array(g):g,i=s.inflateSetDictionary(this.strm,u)),i===o.Z_BUF_ERROR&&!0===m&&(i=o.Z_OK,m=!1),i!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&i!==o.Z_STREAM_END&&(0!==f.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=n.utf8border(f.output,f.next_out),h=f.next_out-l,c=n.buf2string(f.output,l),f.next_out=h,f.avail_out=p-h,h&&r.arraySet(f.output,f.output,l,h,0),this.onData(c)):this.onData(r.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(m=!0)}while((0<f.avail_in||0===f.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(i=s.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(f.avail_out=0))},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){t===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=c,i.inflate=u,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},i.ungzip=u},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,s,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+s),r);else for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){var e,i,s,r,n,o;for(e=s=0,i=t.length;e<i;e++)s+=t[e].length;for(o=new Uint8Array(s),e=r=0,i=t.length;e<i;e++)n=t[e],o.set(n,r),r+=n.length;return o}},n={arraySet:function(t,e,i,s,r){for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,n))},i.setTyped(s)},{}],42:[function(t,e,i){"use strict";var s=t("./common"),r=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){n=!1}for(var o=new s.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(t,e){if(e<65537&&(t.subarray&&n||!t.subarray&&r))return String.fromCharCode.apply(null,s.shrinkBuf(t,e));for(var i="",o=0;o<e;o++)i+=String.fromCharCode(t[o]);return i}o[254]=o[254]=1,i.string2buf=function(t){var e,i,r,n,o,a=t.length,l=0;for(n=0;n<a;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new s.Buf8(l),n=o=0;o<l;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?e[o++]=i:(i<2048?e[o++]=192|i>>>6:(i<65536?e[o++]=224|i>>>12:(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63),e[o++]=128|i>>>6&63),e[o++]=128|63&i);return e},i.buf2binstring=function(t){return l(t,t.length)},i.binstring2buf=function(t){for(var e=new s.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,s,r,n,a=e||t.length,h=new Array(2*a);for(i=s=0;i<a;)if((r=t[i++])<128)h[s++]=r;else if(4<(n=o[r]))h[s++]=65533,i+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&i<a;)r=r<<6|63&t[i++],n--;1<n?h[s++]=65533:r<65536?h[s++]=r:(r-=65536,h[s++]=55296|r>>10&1023,h[s++]=56320|1023&r)}return l(h,s)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+o[t[i]]>e?i:e}},{"./common":41}],43:[function(t,e,i){"use strict";e.exports=function(t,e,i,s){for(var r=65535&t,n=t>>>16&65535,o=0;0!==i;){for(i-=o=2e3<i?2e3:i;n=n+(r=r+e[s++]|0)|0,--o;);r%=65521,n%=65521}return r|n<<16}},{}],44:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,i){"use strict";var s=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,r){var n=s,o=r+i;t^=-1;for(var a=r;a<o;a++)t=t>>>8^n[255&(t^e[a])];return-1^t}},{}],46:[function(t,e,i){"use strict";var s,r=t("../utils/common"),n=t("./trees"),o=t("./adler32"),a=t("./crc32"),l=t("./messages"),h=0,d=4,c=0,u=-2,f=-1,p=4,g=2,m=8,w=9,y=286,b=30,v=19,k=2*y+1,_=15,x=3,S=258,P=S+x+1,L=42,A=113,E=1,C=2,I=3,T=4;function O(t,e){return t.msg=l[e],e}function F(t){return(t<<1)-(4<t?9:0)}function z(t){for(var e=t.length;0<=--e;)t[e]=0}function B(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function R(t,e){n._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,B(t.strm)}function D(t,e){t.pending_buf[t.pending++]=e}function $(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function M(t,e){var i,s,r=t.max_chain_length,n=t.strstart,o=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-P?t.strstart-(t.w_size-P):0,h=t.window,d=t.w_mask,c=t.prev,u=t.strstart+S,f=h[n+o-1],p=h[n+o];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{if(h[(i=e)+o]===p&&h[i+o-1]===f&&h[i]===h[n]&&h[++i]===h[n+1]){n+=2,i++;do{}while(h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&n<u);if(s=S-(u-n),n=u-S,o<s){if(t.match_start=e,a<=(o=s))break;f=h[n+o-1],p=h[n+o]}}}while((e=c[e&d])>l&&0!=--r);return o<=t.lookahead?o:t.lookahead}function U(t){var e,i,s,n,l,h,d,c,u,f,p=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-P)){for(r.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=i=t.hash_size;s=t.head[--e],t.head[e]=p<=s?s-p:0,--i;);for(e=i=p;s=t.prev[--e],t.prev[e]=p<=s?s-p:0,--i;);n+=p}if(0===t.strm.avail_in)break;if(h=t.strm,d=t.window,c=t.strstart+t.lookahead,f=void 0,(u=n)<(f=h.avail_in)&&(f=u),i=0===f?0:(h.avail_in-=f,r.arraySet(d,h.input,h.next_in,f,c),1===h.state.wrap?h.adler=o(h.adler,d,f,c):2===h.state.wrap&&(h.adler=a(h.adler,d,f,c)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=x)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+x-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<x)););}while(t.lookahead<P&&0!==t.strm.avail_in)}function N(t,e){for(var i,s;;){if(t.lookahead<P){if(U(t),t.lookahead<P&&e===h)return E;if(0===t.lookahead)break}if(i=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-P&&(t.match_length=M(t,i)),t.match_length>=x)if(s=n._tr_tally(t,t.strstart-t.match_start,t.match_length-x),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=x){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else s=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(R(t,!1),0===t.strm.avail_out))return E}return t.insert=t.strstart<x-1?t.strstart:x-1,e===d?(R(t,!0),0===t.strm.avail_out?I:T):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?E:C}function j(t,e){for(var i,s,r;;){if(t.lookahead<P){if(U(t),t.lookahead<P&&e===h)return E;if(0===t.lookahead)break}if(i=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=x-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-P&&(t.match_length=M(t,i),t.match_length<=5&&(1===t.strategy||t.match_length===x&&4096<t.strstart-t.match_start)&&(t.match_length=x-1)),t.prev_length>=x&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-x,s=n._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-x),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=x-1,t.strstart++,s&&(R(t,!1),0===t.strm.avail_out))return E}else if(t.match_available){if((s=n._tr_tally(t,0,t.window[t.strstart-1]))&&R(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return E}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=n._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<x-1?t.strstart:x-1,e===d?(R(t,!0),0===t.strm.avail_out?I:T):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?E:C}function W(t,e,i,s,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=s,this.func=r}function Z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*k),this.dyn_dtree=new r.Buf16(2*(2*b+1)),this.bl_tree=new r.Buf16(2*(2*v+1)),z(this.dyn_ltree),z(this.dyn_dtree),z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(_+1),this.heap=new r.Buf16(2*y+1),z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*y+1),z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function H(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=g,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?L:A,t.adler=2===e.wrap?0:1,e.last_flush=h,n._tr_init(e),c):O(t,u)}function G(t){var e=H(t);return e===c&&function(t){t.window_size=2*t.w_size,z(t.head),t.max_lazy_match=s[t.level].max_lazy,t.good_match=s[t.level].good_length,t.nice_match=s[t.level].nice_length,t.max_chain_length=s[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=x-1,t.match_available=0,t.ins_h=0}(t.state),e}function q(t,e,i,s,n,o){if(!t)return u;var a=1;if(e===f&&(e=6),s<0?(a=0,s=-s):15<s&&(a=2,s-=16),n<1||w<n||i!==m||s<8||15<s||e<0||9<e||o<0||p<o)return O(t,u);8===s&&(s=9);var l=new Z;return(t.state=l).strm=t,l.wrap=a,l.gzhead=null,l.w_bits=s,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=n+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+x-1)/x),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<n+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=o,l.method=i,G(t)}s=[new W(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(U(t),0===t.lookahead&&e===h)return E;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var s=t.block_start+i;if((0===t.strstart||t.strstart>=s)&&(t.lookahead=t.strstart-s,t.strstart=s,R(t,!1),0===t.strm.avail_out))return E;if(t.strstart-t.block_start>=t.w_size-P&&(R(t,!1),0===t.strm.avail_out))return E}return t.insert=0,e===d?(R(t,!0),0===t.strm.avail_out?I:T):(t.strstart>t.block_start&&(R(t,!1),t.strm.avail_out),E)}),new W(4,4,8,4,N),new W(4,5,16,8,N),new W(4,6,32,32,N),new W(4,4,16,16,j),new W(8,16,32,32,j),new W(8,16,128,128,j),new W(8,32,128,256,j),new W(32,128,258,1024,j),new W(32,258,258,4096,j)],i.deflateInit=function(t,e){return q(t,e,m,15,8,0)},i.deflateInit2=q,i.deflateReset=G,i.deflateResetKeep=H,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?u:(t.state.gzhead=e,c):u},i.deflate=function(t,e){var i,r,o,l;if(!t||!t.state||5<e||e<0)return t?O(t,u):u;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&e!==d)return O(t,0===t.avail_out?-5:u);if(r.strm=t,i=r.last_flush,r.last_flush=e,r.status===L)if(2===r.wrap)t.adler=0,D(r,31),D(r,139),D(r,8),r.gzhead?(D(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),D(r,255&r.gzhead.time),D(r,r.gzhead.time>>8&255),D(r,r.gzhead.time>>16&255),D(r,r.gzhead.time>>24&255),D(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),D(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(D(r,255&r.gzhead.extra.length),D(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=a(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(D(r,0),D(r,0),D(r,0),D(r,0),D(r,0),D(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),D(r,3),r.status=A);else{var f=m+(r.w_bits-8<<4)<<8;f|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(f|=32),f+=31-f%31,r.status=A,$(r,f),0!==r.strstart&&($(r,t.adler>>>16),$(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),B(t),o=r.pending,r.pending!==r.pending_buf_size));)D(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),B(t),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,D(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),B(t),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,D(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&B(t),r.pending+2<=r.pending_buf_size&&(D(r,255&t.adler),D(r,t.adler>>8&255),t.adler=0,r.status=A)):r.status=A),0!==r.pending){if(B(t),0===t.avail_out)return r.last_flush=-1,c}else if(0===t.avail_in&&F(e)<=F(i)&&e!==d)return O(t,-5);if(666===r.status&&0!==t.avail_in)return O(t,-5);if(0!==t.avail_in||0!==r.lookahead||e!==h&&666!==r.status){var p=2===r.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(U(t),0===t.lookahead)){if(e===h)return E;break}if(t.match_length=0,i=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(R(t,!1),0===t.strm.avail_out))return E}return t.insert=0,e===d?(R(t,!0),0===t.strm.avail_out?I:T):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?E:C}(r,e):3===r.strategy?function(t,e){for(var i,s,r,o,a=t.window;;){if(t.lookahead<=S){if(U(t),t.lookahead<=S&&e===h)return E;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=x&&0<t.strstart&&(s=a[r=t.strstart-1])===a[++r]&&s===a[++r]&&s===a[++r]){o=t.strstart+S;do{}while(s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&r<o);t.match_length=S-(o-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=x?(i=n._tr_tally(t,1,t.match_length-x),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(R(t,!1),0===t.strm.avail_out))return E}return t.insert=0,e===d?(R(t,!0),0===t.strm.avail_out?I:T):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?E:C}(r,e):s[r.level].func(r,e);if(p!==I&&p!==T||(r.status=666),p===E||p===I)return 0===t.avail_out&&(r.last_flush=-1),c;if(p===C&&(1===e?n._tr_align(r):5!==e&&(n._tr_stored_block(r,0,0,!1),3===e&&(z(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),B(t),0===t.avail_out))return r.last_flush=-1,c}return e!==d?c:r.wrap<=0?1:(2===r.wrap?(D(r,255&t.adler),D(r,t.adler>>8&255),D(r,t.adler>>16&255),D(r,t.adler>>24&255),D(r,255&t.total_in),D(r,t.total_in>>8&255),D(r,t.total_in>>16&255),D(r,t.total_in>>24&255)):($(r,t.adler>>>16),$(r,65535&t.adler)),B(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?c:1)},i.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==L&&69!==e&&73!==e&&91!==e&&103!==e&&e!==A&&666!==e?O(t,u):(t.state=null,e===A?O(t,-3):c):u},i.deflateSetDictionary=function(t,e){var i,s,n,a,l,h,d,f,p=e.length;if(!t||!t.state)return u;if(2===(a=(i=t.state).wrap)||1===a&&i.status!==L||i.lookahead)return u;for(1===a&&(t.adler=o(t.adler,e,p,0)),i.wrap=0,p>=i.w_size&&(0===a&&(z(i.head),i.strstart=0,i.block_start=0,i.insert=0),f=new r.Buf8(i.w_size),r.arraySet(f,e,p-i.w_size,i.w_size,0),e=f,p=i.w_size),l=t.avail_in,h=t.next_in,d=t.input,t.avail_in=p,t.next_in=0,t.input=e,U(i);i.lookahead>=x;){for(s=i.strstart,n=i.lookahead-(x-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+x-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++,--n;);i.strstart=s,i.lookahead=x-1,U(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=x-1,i.match_available=0,t.next_in=h,t.input=d,t.avail_in=l,i.wrap=a,c},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,i){"use strict";e.exports=function(t,e){var i,s,r,n,o,a,l,h,d,c,u,f,p,g,m,w,y,b,v,k,_,x,S,P,L;i=t.state,s=t.next_in,P=t.input,r=s+(t.avail_in-5),n=t.next_out,L=t.output,o=n-(e-t.avail_out),a=n+(t.avail_out-257),l=i.dmax,h=i.wsize,d=i.whave,c=i.wnext,u=i.window,f=i.hold,p=i.bits,g=i.lencode,m=i.distcode,w=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;t:do{p<15&&(f+=P[s++]<<p,p+=8,f+=P[s++]<<p,p+=8),b=g[f&w];e:for(;;){if(f>>>=v=b>>>24,p-=v,0==(v=b>>>16&255))L[n++]=65535&b;else{if(!(16&v)){if(!(64&v)){b=g[(65535&b)+(f&(1<<v)-1)];continue e}if(32&v){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}k=65535&b,(v&=15)&&(p<v&&(f+=P[s++]<<p,p+=8),k+=f&(1<<v)-1,f>>>=v,p-=v),p<15&&(f+=P[s++]<<p,p+=8,f+=P[s++]<<p,p+=8),b=m[f&y];i:for(;;){if(f>>>=v=b>>>24,p-=v,!(16&(v=b>>>16&255))){if(!(64&v)){b=m[(65535&b)+(f&(1<<v)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(_=65535&b,p<(v&=15)&&(f+=P[s++]<<p,(p+=8)<v&&(f+=P[s++]<<p,p+=8)),l<(_+=f&(1<<v)-1)){t.msg="invalid distance too far back",i.mode=30;break t}if(f>>>=v,p-=v,(v=n-o)<_){if(d<(v=_-v)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(S=u,(x=0)===c){if(x+=h-v,v<k){for(k-=v;L[n++]=u[x++],--v;);x=n-_,S=L}}else if(c<v){if(x+=h+c-v,(v-=c)<k){for(k-=v;L[n++]=u[x++],--v;);if(x=0,c<k){for(k-=v=c;L[n++]=u[x++],--v;);x=n-_,S=L}}}else if(x+=c-v,v<k){for(k-=v;L[n++]=u[x++],--v;);x=n-_,S=L}for(;2<k;)L[n++]=S[x++],L[n++]=S[x++],L[n++]=S[x++],k-=3;k&&(L[n++]=S[x++],1<k&&(L[n++]=S[x++]))}else{for(x=n-_;L[n++]=L[x++],L[n++]=L[x++],L[n++]=L[x++],2<(k-=3););k&&(L[n++]=L[x++],1<k&&(L[n++]=L[x++]))}break}}break}}while(s<r&&n<a);s-=k=p>>3,f&=(1<<(p-=k<<3))-1,t.next_in=s,t.next_out=n,t.avail_in=s<r?r-s+5:5-(s-r),t.avail_out=n<a?a-n+257:257-(n-a),i.hold=f,i.bits=p}},{}],49:[function(t,e,i){"use strict";var s=t("../utils/common"),r=t("./adler32"),n=t("./crc32"),o=t("./inffast"),a=t("./inftrees"),l=1,h=2,d=0,c=-2,u=1,f=852,p=592;function g(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=u,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new s.Buf32(f),e.distcode=e.distdyn=new s.Buf32(p),e.sane=1,e.back=-1,d):c}function y(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,w(t)):c}function b(t,e){var i,s;return t&&t.state?(s=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?c:(null!==s.window&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,y(t))):c}function v(t,e){var i,s;return t?(s=new m,(t.state=s).window=null,(i=b(t,e))!==d&&(t.state=null),i):c}var k,_,x=!0;function S(t){if(x){var e;for(k=new s.Buf32(512),_=new s.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(l,t.lens,0,288,k,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(h,t.lens,0,32,_,0,t.work,{bits:5}),x=!1}t.lencode=k,t.lenbits=9,t.distcode=_,t.distbits=5}function P(t,e,i,r){var n,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new s.Buf8(o.wsize)),r>=o.wsize?(s.arraySet(o.window,e,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r<(n=o.wsize-o.wnext)&&(n=r),s.arraySet(o.window,e,i-r,n,o.wnext),(r-=n)?(s.arraySet(o.window,e,i-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0}i.inflateReset=y,i.inflateReset2=b,i.inflateResetKeep=w,i.inflateInit=function(t){return v(t,15)},i.inflateInit2=v,i.inflate=function(t,e){var i,f,p,m,w,y,b,v,k,_,x,L,A,E,C,I,T,O,F,z,B,R,D,$,M=0,U=new s.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return c;12===(i=t.state).mode&&(i.mode=13),w=t.next_out,p=t.output,b=t.avail_out,m=t.next_in,f=t.input,y=t.avail_in,v=i.hold,k=i.bits,_=y,x=b,R=d;t:for(;;)switch(i.mode){case u:if(0===i.wrap){i.mode=13;break}for(;k<16;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(2&i.wrap&&35615===v){U[i.check=0]=255&v,U[1]=v>>>8&255,i.check=n(i.check,U,2,0),k=v=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&v)){t.msg="unknown compression method",i.mode=30;break}if(k-=4,B=8+(15&(v>>>=4)),0===i.wbits)i.wbits=B;else if(B>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<B,t.adler=i.check=1,i.mode=512&v?10:12,k=v=0;break;case 2:for(;k<16;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(i.flags=v,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=v>>8&1),512&i.flags&&(U[0]=255&v,U[1]=v>>>8&255,i.check=n(i.check,U,2,0)),k=v=0,i.mode=3;case 3:for(;k<32;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}i.head&&(i.head.time=v),512&i.flags&&(U[0]=255&v,U[1]=v>>>8&255,U[2]=v>>>16&255,U[3]=v>>>24&255,i.check=n(i.check,U,4,0)),k=v=0,i.mode=4;case 4:for(;k<16;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}i.head&&(i.head.xflags=255&v,i.head.os=v>>8),512&i.flags&&(U[0]=255&v,U[1]=v>>>8&255,i.check=n(i.check,U,2,0)),k=v=0,i.mode=5;case 5:if(1024&i.flags){for(;k<16;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}i.length=v,i.head&&(i.head.extra_len=v),512&i.flags&&(U[0]=255&v,U[1]=v>>>8&255,i.check=n(i.check,U,2,0)),k=v=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(y<(L=i.length)&&(L=y),L&&(i.head&&(B=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),s.arraySet(i.head.extra,f,m,L,B)),512&i.flags&&(i.check=n(i.check,f,L,m)),y-=L,m+=L,i.length-=L),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===y)break t;for(L=0;B=f[m+L++],i.head&&B&&i.length<65536&&(i.head.name+=String.fromCharCode(B)),B&&L<y;);if(512&i.flags&&(i.check=n(i.check,f,L,m)),y-=L,m+=L,B)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===y)break t;for(L=0;B=f[m+L++],i.head&&B&&i.length<65536&&(i.head.comment+=String.fromCharCode(B)),B&&L<y;);if(512&i.flags&&(i.check=n(i.check,f,L,m)),y-=L,m+=L,B)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;k<16;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(v!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}k=v=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;k<32;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}t.adler=i.check=g(v),k=v=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=w,t.avail_out=b,t.next_in=m,t.avail_in=y,i.hold=v,i.bits=k,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){v>>>=7&k,k-=7&k,i.mode=27;break}for(;k<3;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}switch(i.last=1&v,k-=1,3&(v>>>=1)){case 0:i.mode=14;break;case 1:if(S(i),i.mode=20,6!==e)break;v>>>=2,k-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}v>>>=2,k-=2;break;case 14:for(v>>>=7&k,k-=7&k;k<32;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&v,k=v=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(L=i.length){if(y<L&&(L=y),b<L&&(L=b),0===L)break t;s.arraySet(p,f,m,L,w),y-=L,m+=L,b-=L,w+=L,i.length-=L;break}i.mode=12;break;case 17:for(;k<14;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(i.nlen=257+(31&v),v>>>=5,k-=5,i.ndist=1+(31&v),v>>>=5,k-=5,i.ncode=4+(15&v),v>>>=4,k-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;k<3;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}i.lens[N[i.have++]]=7&v,v>>>=3,k-=3}for(;i.have<19;)i.lens[N[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,D={bits:i.lenbits},R=a(0,i.lens,0,19,i.lencode,0,i.work,D),i.lenbits=D.bits,R){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;I=(M=i.lencode[v&(1<<i.lenbits)-1])>>>16&255,T=65535&M,!((C=M>>>24)<=k);){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(T<16)v>>>=C,k-=C,i.lens[i.have++]=T;else{if(16===T){for($=C+2;k<$;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(v>>>=C,k-=C,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}B=i.lens[i.have-1],L=3+(3&v),v>>>=2,k-=2}else if(17===T){for($=C+3;k<$;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}k-=C,B=0,L=3+(7&(v>>>=C)),v>>>=3,k-=3}else{for($=C+7;k<$;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}k-=C,B=0,L=11+(127&(v>>>=C)),v>>>=7,k-=7}if(i.have+L>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;L--;)i.lens[i.have++]=B}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,D={bits:i.lenbits},R=a(l,i.lens,0,i.nlen,i.lencode,0,i.work,D),i.lenbits=D.bits,R){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,D={bits:i.distbits},R=a(h,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,D),i.distbits=D.bits,R){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=y&&258<=b){t.next_out=w,t.avail_out=b,t.next_in=m,t.avail_in=y,i.hold=v,i.bits=k,o(t,x),w=t.next_out,p=t.output,b=t.avail_out,m=t.next_in,f=t.input,y=t.avail_in,v=i.hold,k=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;I=(M=i.lencode[v&(1<<i.lenbits)-1])>>>16&255,T=65535&M,!((C=M>>>24)<=k);){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(I&&!(240&I)){for(O=C,F=I,z=T;I=(M=i.lencode[z+((v&(1<<O+F)-1)>>O)])>>>16&255,T=65535&M,!(O+(C=M>>>24)<=k);){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}v>>>=O,k-=O,i.back+=O}if(v>>>=C,k-=C,i.back+=C,i.length=T,0===I){i.mode=26;break}if(32&I){i.back=-1,i.mode=12;break}if(64&I){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&I,i.mode=22;case 22:if(i.extra){for($=i.extra;k<$;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}i.length+=v&(1<<i.extra)-1,v>>>=i.extra,k-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;I=(M=i.distcode[v&(1<<i.distbits)-1])>>>16&255,T=65535&M,!((C=M>>>24)<=k);){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(!(240&I)){for(O=C,F=I,z=T;I=(M=i.distcode[z+((v&(1<<O+F)-1)>>O)])>>>16&255,T=65535&M,!(O+(C=M>>>24)<=k);){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}v>>>=O,k-=O,i.back+=O}if(v>>>=C,k-=C,i.back+=C,64&I){t.msg="invalid distance code",i.mode=30;break}i.offset=T,i.extra=15&I,i.mode=24;case 24:if(i.extra){for($=i.extra;k<$;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}i.offset+=v&(1<<i.extra)-1,v>>>=i.extra,k-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===b)break t;if(L=x-b,i.offset>L){if((L=i.offset-L)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}A=L>i.wnext?(L-=i.wnext,i.wsize-L):i.wnext-L,L>i.length&&(L=i.length),E=i.window}else E=p,A=w-i.offset,L=i.length;for(b<L&&(L=b),b-=L,i.length-=L;p[w++]=E[A++],--L;);0===i.length&&(i.mode=21);break;case 26:if(0===b)break t;p[w++]=i.length,b--,i.mode=21;break;case 27:if(i.wrap){for(;k<32;){if(0===y)break t;y--,v|=f[m++]<<k,k+=8}if(x-=b,t.total_out+=x,i.total+=x,x&&(t.adler=i.check=i.flags?n(i.check,p,x,w-x):r(i.check,p,x,w-x)),x=b,(i.flags?v:g(v))!==i.check){t.msg="incorrect data check",i.mode=30;break}k=v=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;k<32;){if(0===y)break t;y--,v+=f[m++]<<k,k+=8}if(v!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}k=v=0}i.mode=29;case 29:R=1;break t;case 30:R=-3;break t;case 31:return-4;default:return c}return t.next_out=w,t.avail_out=b,t.next_in=m,t.avail_in=y,i.hold=v,i.bits=k,(i.wsize||x!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&P(t,t.output,t.next_out,x-t.avail_out)?(i.mode=31,-4):(_-=t.avail_in,x-=t.avail_out,t.total_in+=_,t.total_out+=x,i.total+=x,i.wrap&&x&&(t.adler=i.check=i.flags?n(i.check,p,x,t.next_out-x):r(i.check,p,x,t.next_out-x)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==_&&0===x||4===e)&&R===d&&(R=-5),R)},i.inflateEnd=function(t){if(!t||!t.state)return c;var e=t.state;return e.window&&(e.window=null),t.state=null,d},i.inflateGetHeader=function(t,e){var i;return t&&t.state&&2&(i=t.state).wrap?((i.head=e).done=!1,d):c},i.inflateSetDictionary=function(t,e){var i,s=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?c:11===i.mode&&r(1,e,s,0)!==i.check?-3:P(t,e,s,s)?(i.mode=31,-4):(i.havedict=1,d):c},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,i){"use strict";var s=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,l,h,d,c,u){var f,p,g,m,w,y,b,v,k,_=u.bits,x=0,S=0,P=0,L=0,A=0,E=0,C=0,I=0,T=0,O=0,F=null,z=0,B=new s.Buf16(16),R=new s.Buf16(16),D=null,$=0;for(x=0;x<=15;x++)B[x]=0;for(S=0;S<l;S++)B[e[i+S]]++;for(A=_,L=15;1<=L&&0===B[L];L--);if(L<A&&(A=L),0===L)return h[d++]=20971520,h[d++]=20971520,u.bits=1,0;for(P=1;P<L&&0===B[P];P++);for(A<P&&(A=P),x=I=1;x<=15;x++)if(I<<=1,(I-=B[x])<0)return-1;if(0<I&&(0===t||1!==L))return-1;for(R[1]=0,x=1;x<15;x++)R[x+1]=R[x]+B[x];for(S=0;S<l;S++)0!==e[i+S]&&(c[R[e[i+S]]++]=S);if(y=0===t?(F=D=c,19):1===t?(F=r,z-=257,D=n,$-=257,256):(F=o,D=a,-1),x=P,w=d,C=S=O=0,g=-1,m=(T=1<<(E=A))-1,1===t&&852<T||2===t&&592<T)return 1;for(;;){for(b=x-C,k=c[S]<y?(v=0,c[S]):c[S]>y?(v=D[$+c[S]],F[z+c[S]]):(v=96,0),f=1<<x-C,P=p=1<<E;h[w+(O>>C)+(p-=f)]=b<<24|v<<16|k,0!==p;);for(f=1<<x-1;O&f;)f>>=1;if(0!==f?(O&=f-1,O+=f):O=0,S++,0==--B[x]){if(x===L)break;x=e[i+c[S]]}if(A<x&&(O&m)!==g){for(0===C&&(C=A),w+=P,I=1<<(E=x-C);E+C<L&&!((I-=B[E+C])<=0);)E++,I<<=1;if(T+=1<<E,1===t&&852<T||2===t&&592<T)return 1;h[g=O&m]=A<<24|E<<16|w-d}}return 0!==O&&(h[w+O]=x-C<<24|64<<16),u.bits=A,0}},{"../utils/common":41}],51:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,i){"use strict";var s=t("../utils/common"),r=0,n=1;function o(t){for(var e=t.length;0<=--e;)t[e]=0}var a=0,l=29,h=256,d=h+1+l,c=30,u=19,f=2*d+1,p=15,g=16,m=7,w=256,y=16,b=17,v=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=new Array(2*(d+2));o(P);var L=new Array(2*c);o(L);var A=new Array(512);o(A);var E=new Array(256);o(E);var C=new Array(l);o(C);var I,T,O,F=new Array(c);function z(t,e,i,s,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=t&&t.length}function B(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function R(t){return t<256?A[t]:A[256+(t>>>7)]}function D(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function $(t,e,i){t.bi_valid>g-i?(t.bi_buf|=e<<t.bi_valid&65535,D(t,t.bi_buf),t.bi_buf=e>>g-t.bi_valid,t.bi_valid+=i-g):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function M(t,e,i){$(t,i[2*e],i[2*e+1])}function U(t,e){for(var i=0;i|=1&t,t>>>=1,i<<=1,0<--e;);return i>>>1}function N(t,e,i){var s,r,n=new Array(p+1),o=0;for(s=1;s<=p;s++)n[s]=o=o+i[s-1]<<1;for(r=0;r<=e;r++){var a=t[2*r+1];0!==a&&(t[2*r]=U(n[a]++,a))}}function j(t){var e;for(e=0;e<d;e++)t.dyn_ltree[2*e]=0;for(e=0;e<c;e++)t.dyn_dtree[2*e]=0;for(e=0;e<u;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*w]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function W(t){8<t.bi_valid?D(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function Z(t,e,i,s){var r=2*e,n=2*i;return t[r]<t[n]||t[r]===t[n]&&s[e]<=s[i]}function H(t,e,i){for(var s=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&Z(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!Z(e,s,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=s}function G(t,e,i){var s,r,n,o,a=0;if(0!==t.last_lit)for(;s=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],r=t.pending_buf[t.l_buf+a],a++,0===s?M(t,r,e):(M(t,(n=E[r])+h+1,e),0!==(o=k[n])&&$(t,r-=C[n],o),M(t,n=R(--s),i),0!==(o=_[n])&&$(t,s-=F[n],o)),a<t.last_lit;);M(t,w,e)}function q(t,e){var i,s,r,n=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=f,i=0;i<l;i++)0!==n[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):n[2*i+1]=0;for(;t.heap_len<2;)n[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,a&&(t.static_len-=o[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;1<=i;i--)H(t,n,i);for(r=l;i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],H(t,n,1),s=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=s,n[2*r]=n[2*i]+n[2*s],t.depth[r]=(t.depth[i]>=t.depth[s]?t.depth[i]:t.depth[s])+1,n[2*i+1]=n[2*s+1]=r,t.heap[1]=r++,H(t,n,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,s,r,n,o,a,l=e.dyn_tree,h=e.max_code,d=e.stat_desc.static_tree,c=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,g=e.stat_desc.extra_base,m=e.stat_desc.max_length,w=0;for(n=0;n<=p;n++)t.bl_count[n]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<f;i++)m<(n=l[2*l[2*(s=t.heap[i])+1]+1]+1)&&(n=m,w++),l[2*s+1]=n,h<s||(t.bl_count[n]++,o=0,g<=s&&(o=u[s-g]),a=l[2*s],t.opt_len+=a*(n+o),c&&(t.static_len+=a*(d[2*s+1]+o)));if(0!==w){do{for(n=m-1;0===t.bl_count[n];)n--;t.bl_count[n]--,t.bl_count[n+1]+=2,t.bl_count[m]--,w-=2}while(0<w);for(n=m;0!==n;n--)for(s=t.bl_count[n];0!==s;)h<(r=t.heap[--i])||(l[2*r+1]!==n&&(t.opt_len+=(n-l[2*r+1])*l[2*r],l[2*r+1]=n),s--)}}(t,e),N(n,h,t.bl_count)}function K(t,e,i){var s,r,n=-1,o=e[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),e[2*(i+1)+1]=65535,s=0;s<=i;s++)r=o,o=e[2*(s+1)+1],++a<l&&r===o||(a<h?t.bl_tree[2*r]+=a:0!==r?(r!==n&&t.bl_tree[2*r]++,t.bl_tree[2*y]++):a<=10?t.bl_tree[2*b]++:t.bl_tree[2*v]++,n=r,h=(a=0)===o?(l=138,3):r===o?(l=6,3):(l=7,4))}function V(t,e,i){var s,r,n=-1,o=e[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),s=0;s<=i;s++)if(r=o,o=e[2*(s+1)+1],!(++a<l&&r===o)){if(a<h)for(;M(t,r,t.bl_tree),0!=--a;);else 0!==r?(r!==n&&(M(t,r,t.bl_tree),a--),M(t,y,t.bl_tree),$(t,a-3,2)):a<=10?(M(t,b,t.bl_tree),$(t,a-3,3)):(M(t,v,t.bl_tree),$(t,a-11,7));n=r,h=(a=0)===o?(l=138,3):r===o?(l=6,3):(l=7,4)}}o(F);var J=!1;function Y(t,e,i,r){$(t,(a<<1)+(r?1:0),3),function(t,e,i,r){W(t),r&&(D(t,i),D(t,~i)),s.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}i._tr_init=function(t){J||(function(){var t,e,i,s,r,n=new Array(p+1);for(s=i=0;s<l-1;s++)for(C[s]=i,t=0;t<1<<k[s];t++)E[i++]=s;for(E[i-1]=s,s=r=0;s<16;s++)for(F[s]=r,t=0;t<1<<_[s];t++)A[r++]=s;for(r>>=7;s<c;s++)for(F[s]=r<<7,t=0;t<1<<_[s]-7;t++)A[256+r++]=s;for(e=0;e<=p;e++)n[e]=0;for(t=0;t<=143;)P[2*t+1]=8,t++,n[8]++;for(;t<=255;)P[2*t+1]=9,t++,n[9]++;for(;t<=279;)P[2*t+1]=7,t++,n[7]++;for(;t<=287;)P[2*t+1]=8,t++,n[8]++;for(N(P,d+1,n),t=0;t<c;t++)L[2*t+1]=5,L[2*t]=U(t,5);I=new z(P,k,h+1,d,p),T=new z(L,_,0,c,p),O=new z(new Array(0),x,0,u,m)}(),J=!0),t.l_desc=new B(t.dyn_ltree,I),t.d_desc=new B(t.dyn_dtree,T),t.bl_desc=new B(t.bl_tree,O),t.bi_buf=0,t.bi_valid=0,j(t)},i._tr_stored_block=Y,i._tr_flush_block=function(t,e,i,s){var o,a,l=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return r;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return n;for(e=32;e<h;e++)if(0!==t.dyn_ltree[2*e])return n;return r}(t)),q(t,t.l_desc),q(t,t.d_desc),l=function(t){var e;for(K(t,t.dyn_ltree,t.l_desc.max_code),K(t,t.dyn_dtree,t.d_desc.max_code),q(t,t.bl_desc),e=u-1;3<=e&&0===t.bl_tree[2*S[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),o=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=o&&(o=a)):o=a=i+5,i+4<=o&&-1!==e?Y(t,e,i,s):4===t.strategy||a===o?($(t,2+(s?1:0),3),G(t,P,L)):($(t,4+(s?1:0),3),function(t,e,i,s){var r;for($(t,e-257,5),$(t,i-1,5),$(t,s-4,4),r=0;r<s;r++)$(t,t.bl_tree[2*S[r]+1],3);V(t,t.dyn_ltree,e-1),V(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),G(t,t.dyn_ltree,t.dyn_dtree)),j(t),s&&W(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(E[i]+h+1)]++,t.dyn_dtree[2*R(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){$(t,2,3),M(t,w,P),function(t){16===t.bi_valid?(D(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,s){(function(t){!function(t,e){"use strict";if(!t.setImmediate){var i,s,r,n,o=1,a={},l=!1,h=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,i="[object process]"==={}.toString.call(t.process)?function(t){process.nextTick(function(){u(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?(n="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",f,!1):t.attachEvent("onmessage",f),function(e){t.postMessage(n+e,"*")}):t.MessageChannel?((r=new MessageChannel).port1.onmessage=function(t){u(t.data)},function(t){r.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(s=h.documentElement,function(t){var e=h.createElement("script");e.onreadystatechange=function(){u(t),e.onreadystatechange=null,s.removeChild(e),e=null},s.appendChild(e)}):function(t){setTimeout(u,0,t)},d.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),s=0;s<e.length;s++)e[s]=arguments[s+1];var r={callback:t,args:e};return a[o]=r,i(o),o++},d.clearImmediate=c}function c(t){delete a[t]}function u(t){if(l)setTimeout(u,0,t);else{var i=a[t];if(i){l=!0;try{!function(t){var i=t.callback,s=t.args;switch(s.length){case 0:i();break;case 1:i(s[0]);break;case 2:i(s[0],s[1]);break;case 3:i(s[0],s[1],s[2]);break;default:i.apply(e,s)}}(i)}finally{c(t),l=!1}}}}function f(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(n)&&u(+e.data.slice(n.length))}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)},768:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>w});var s=i(72),r=i.n(s),n=i(825),o=i.n(n),a=i(659),l=i.n(a),h=i(56),d=i.n(h),c=i(540),u=i.n(c),f=i(113),p=i.n(f),g=i(707),m={};m.styleTagTransform=p(),m.setAttributes=d(),m.insert=l().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=u();r()(g.A,m);const w=g.A&&g.A.locals?g.A.locals:void 0},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,r&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={id:s,exports:{}};return t[s](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0;var s={};(()=>{"use strict";i.d(s,{i:()=>et});var t=i(616);const e=t=>{const e=t.getDefaultLayers(),i=$("<select>",{id:"layer"});return t.layers.all.forEach((t,s)=>{i.append($("<option>",{value:t.id,text:t.name,selected:t.id===e[0]}))}),$("<div>").append($("<lable>",{for:"layer",text:"Layer"}),$("<br>"),i,$("<br>"),$("<br>"),$("<lable>",{for:"portalText",text:"Portal Description"}),$("<br>"),$("<input>",{type:"text",id:"portalText"}))},r=t=>({layer:parseInt($("#layer",t).val()),portalText:$("#portalText",t).val()}),n={color:"#559900",interactive:!1,clickable:!1},o={color:"#9d8544",dashArray:"6 8",interactive:!1,clickable:!1,weight:4},a={color:"#9d8544",radius:16},l=["#559900","#990055","#559955","#999955","#995555"];class h{init(){this.initIcon(),this.layer=new L.LayerGroup,window.map.addLayer(this.layer),this.fields=0,this.links=[],this.portals=[],this.walkPortals=[]}initIcon(){this.markerIcon=L.icon({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAocSURBVHjanNRbUFN3Hgfwv9Pdzu5sZ7cP3d1eprP7sC/bPvSls9MmB5CLcg2IIAhSWwS8rFqrpbVbu3Vdd2ov04qJgGBESAJJCOR2AiFcEpKT+wkhiIiCoCJKkQhCIEgEvvsQcaoVdffhM+fMOf///3v+5/c7h8S8lk64f0wkH7/9LZGnsUSczBBREkNESRaieM9JOg6fJzUJljckPGajhMfsF6dYjolTLMV16bZMxRbnW2KehUhSGSJKtBBlvptIM+2kJt5CRIkWIkljiCSVIWS1EHEyQ6SZtrdVBe5jomRLd126dVa6ybZYn+OAbJN9qS7dOidJYy6Iki3fS3gM5/8J+bMo0VJZm2pdaHjPiaZ9XrR+dg6tn59D26FetB06h9Z/nEPzvm4ot7lRl25drI43Vzd+4PrLM4WIkpjImkRmWJHnQktxD9o+70XLJz7o9nWD3uMFvdsLeo8Xug+7oS/23b/fg4b3XBClMNfFyUx8TeIjIWtfTSPv/iGeHHj7GyLnseniJGZGs8ODtkO9aP6oG9qdXdDs8EC3x4s+5SjujMzhIn0DTfu6odnhgXZnF5o+6kbboV5odnZBlMQEaxIsuQ+FJLy+mUS/toF88vb3f5Mlu+9od3XBcPActDu7oC70QF3kgbP0Mu5cD2LOv4DFhSXM+Rcwc3MebMUQ1EUeqAs90OwMz6N3e1GTYJkVJVooSSpDalNthFTEtJKKmNbfnonruKDaxsJwsAfq7R6oClmYjl7Arb5p3J25hz7lKFo/78XsrbswHu7DOekI5qdCmLg4A/OxfqgKWai3e2D4tAfKAjeq15sHqtebf3c6ro2QmnUMqY61HJJutMPwaQ80OzzQ7/dhqGMc94KLuO68jdbPzkFVwEJ/wIfQ3CLaDvVCVcDC8GkPrjITuBdcxBXzLbQU9zwIkmU4ULHW8GX869mEnI0z//5snHlcu6sLur1euMuHMHvrLvwDAZi/7odymxvKfBbKfBa6vd0Y892B/uMeKLexYfn3d9w/jTn/ArqEw9Dt9YL+uxfCGOPE/re+e5lUxXTmSVKt0B8It+P0aBCDhh+hKmShzHdDXchCs90D7Y4welfXg3PNdg80RR405ruhKmTRr72B6dEglNvcaD7gQ22aFeI4x1ZyJsokVuQ5odvrhSLPhduDAdiOD6D9n+H3Hxibx/RoEJPDs5geDWL6ehDTo0FMXZnF9PUgAmPzmPMvwHT0Asxf9cM/GIAizwXdXi8a8pw4E2WSEGGUyakqYKHZ4YFiSzjEXX4ZjVtdGD8/DQBYureMPuUoTEf6YDx8HqYjfeiVj+De3SUAgH8wgMb33bAfH8DtwQAUW1zQbPdAVcBCGGV0E+Fa41X1/QsNueEQtnwIDVtcaP/iPEL3ix8Ym8c16wSMh/swbBzH7PhdjDj8uDe/CNO/L0CR54KjZBC3BwNoyHVBVRDuNuFa4zUiXGu8odnugTLfDflmB/yDAbjKLkOR64Qi14mhjnGMspPQfdiNUddtLC8t46Z3Cvr9PlxlJjBi80OR60R9jhO245fgHwxAvtkBZb4bmnDIDVIZ2e5uzHdDuc0NWbYD/oFwSP1mB+Q5TqiLWCwE7sHyzUU05LkwPxWCusgD4+E+hIKLoHd7Ic9xQr7ZAdsPl+AfCECW7YAyn0XjB25URrazpJwyyGTZdqiLPJBussM/GIC9ZACybDtMR/qgL/bBW3MFMzeC0O31IjA2j+b9PkwOz6K3fgRNH3aj8z8XIM92gPn6IvwDAUg3hdeTZdtRTrU2kNPR7Xuqkzqh2d4FWZYdE/0z8ImvYkA/hsW7S3CfGoIs246pa3MYNPwI/2AAg/oxzIwGUZ/jhP34AELBRQx1jMNbdQUT/TOQZdmh2dGF6qROnI5p30fKI/R/rYhqDakKWNTnOnH7cgAAMMpOoqW4B9JMO2SZdpi/6sfy0jJCwUUAgO2HS5BtskOaaYd+vw8jdj+wDExemUV9rhPqAhanogyh8gjDm6SMal5zkqNrrctkoMxn4au9hqXQEi63/whlgRvSDBvqNtohzbBhxOEHANzsnoI0w/6A8gM3LjXdxPLSMnrlI1BtY1GbweDku7qW8gj9GlIWoScCLp1TEWuAqsADaYYN+mIfxnqmEJxcgE98FfU5TtSl29C0rxvzd0IwHOxB3UYbZFl2dFVdwZx/AePnp2E42ANppg3qQg8qYw3gc+iMk5SOkBMcNSnhqF8QcOgheY4Dii1OiHkMJKkMLN/0487IHKauzcF8rB+1G6zQ7e5C3QYrOo/2YXJoFjM3grD9cAkSHgMxj4EizwX5Zgf4HLr/BFfzqxNcDSF8Skv4lJac4GiOnEnogDKfhSQtHCJJZSDLssMnuYb5qRBueCZhPNKHEYcfd6dDOF9/HYocZ3gsj4EkjYEqn4Uwvh18jvZgKdVESqkmQkojmsOopj8JKN1teY4D8mwHxCnhJxPzGIhTGKiLWAybbmH+TgjXrBPQ7OqCmGeFhGeFOIWBKIVBfY4D8s0OCLj0mICiXxZQNBFQNCHlES0P8DnaY8L4djRudYcnJjEQJTMQr0j6OVFyeJyYx6DxfTdOr2sDn0N/sbKLUqqJkJW0+14RcOlxaZYdsk121CRYIEp8upoES7idN9kg4NLXS6mmlx4K4XO1DznB0Xx5el0bFHkuiJLCCzyNKNkCRZ4LlXGtEHDo4p8GPDaEz9W+JODSo9JMG6QZdpyNM6N63erOxpkhzbSjLsMKAVc3LKDoFwWUjvwUeTS1lGoiAg79SWVsKxS5TlSvt+BsbHixn4k1ozreAkWOExUxBgi4ur1lEXryqEdrsuJFAYcelqQzqNtgQ1VMJ6pif+5MTCfq0m0Qb2DA52gvlXBUL5SEv7uHkEe3toLP1e6uiDZAnuVA9TozqqI7w2ErojtRvd4MebYDp6INKOGoi0o4KvI4pDzSsIqW3/A52osingW1qVYIo4w4E2V6QBhlRG2qFSKeGXwufZ7P1f76MfUlfK72sYX/aacVnFrbAmmGHVWxnRBGGiGMMkIYaURVbCekGXaURelRRjVvPR3ZTioj2x6LnKR0T/IrPofuqUnuhIRnRWVkB05HdaAysgMSnhU1yZ3gc7TeEo76+RMcNVkNWe09rjjBUeeWR+lRt8EGYYwRp6hWCGOMqNtgQ3mUHgKKzlr5/62GPG0An9L+UsCl2eoEE0RJFpRTBoiSLDibYMJJSuesjjf/oibBTJ6EVMd3PlFNgplURBvSSyOaIE5hUBVngjiFQVlkM757pz7t23dk5GnIqUjDs3iOz9UyZ9Z1hL+b9SZ8/26Def3rWc+tfYVHol9Ne6KnFf4BPleTWBbZDFGSBWWRehznqBJ2v3mU7HzjMNn1xr+e6Ikt/Ig1AopuK4vQQ0DRrXyudk15RAs5FWF4qtV+K6uJE1DaUPj47PP+15DnBRRdeP/4zPP+OwCV955x/18hzAAAAABJRU5ErkJggg==",iconSize:new L.Point(25,41),iconAnchor:new L.Point(12,41),popupAnchor:new L.Point(1,-34)})}destroy(){window.map.removeLayer(this.layer),this.layer=void 0}clear(){this.fields=0,this.links.length=0,this.portals.length=0,this.walkPortals=[],$("#dialog-moreFields #keylist").hide()}showKeys(){$("#dialog-moreFields #keylist").show()}isEmpty(){return 0===this.links.length&&0===this.portals.length}addPortal(t){this.portals.push(t)}addLink(t,e,i="",s){this.links.push({origin:t,destination:e,comment:i,group:s})}addDblLink(t,e,i){this.addLink(t,e),this.addLink(t,i)}setWalkingPath(t){this.walkPortals=[...t]}render(t){this.layer.clearLayers(),this.renderPortals(t),this.renderLinks(t),this.renderLabels(t)}getLinks(){return this.links}renderPortals(t){this.portals.forEach(t=>{this.layer.addLayer(L.marker(t.position,{icon:this.markerIcon}))})}renderLinks(t){let e=-1,i=-1;this.links.forEach(t=>{t.group!==e&&(e=t.group,i=(i+1)%l.length,n.color=l[i]),this.layer.addLayer(L.geodesicPolyline([t.origin.position,t.destination.position],n))}),t.showPath&&this.renderPath(),this.updateSBULS(this.links)}renderLabels(t){const e=this.getPortalOrder(this.links),i=e.map(t=>this.getKeyCount(this.links,t));this.updateKeyCount(i),this.updateSBULS(this.links),this.renderLabels2(e,i,t.showOrder,t.showKeys)}renderLabels2(t,e,i,s){const r=(i?1:0)+(s?2:0);0!==r&&t.forEach((t,i)=>{let s;const n=e[i];switch(r){case 1:s=`${i+1}`;break;case 2:s=`Keys: ${n}`;break;case 3:s=`${i+1}<br>Keys: ${n}`}const o=L.marker(t.position,{icon:L.divIcon({className:"morefield_label",iconAnchor:[0,0],iconSize:[100,49],html:s})});this.layer.addLayer(o)})}renderPath(){let t=this.walkPortals;if(0===t.length&&(t=this.getPortalOrder(this.links)),0===t.length)return;const e=t.map(t=>t.position);this.layer.addLayer(L.geodesicPolyline(e,o)),this.layer.addLayer(L.circleMarker(t[0].position,a))}updateKeyCount(t){const e=new Map;t.forEach(t=>{var i;t>0&&e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:0)+1)});const i=[...e.keys()];i.sort((t,e)=>e-t);const s=i.map(t=>`${e.get(t)}x${t}`).join(",");$("#dialog-moreFields #keylist").text(s)}updateSBULS(t){const e=new Map;t.forEach(t=>{var i;const s=t.origin.guid;e.set(s,(null!==(i=e.get(s))&&void 0!==i?i:0)+1)});const i=[];e.forEach(t=>{const e=Math.floor(t/8);i[e]=(i[e]||0)+1}),i[0]=0;const s=i.map((t,e)=>t>0?`${t}x${e}`:"").filter(t=>""!==t).join(",");$("#dialog-moreFields #sbulslist").text(s),""===s?$("#dialog-moreFields #sbulslist_block").hide():$("#dialog-moreFields #sbulslist_block").show()}getPortalOrder(t){if(0===t.length)return[];const e=[];let i=t[0].destination;return e.push(i),t.forEach(t=>{t.origin.guid!==i.guid&&(i=t.origin,e.push(i))}),e}getKeyCount(t,e){return t.reduce((t,i)=>i.destination.guid===e.guid?t+1:t,0)}toDrawToolsString(){const t=this.links.map(t=>({type:"polyline",latLngs:[t.origin.position,t.destination.position]}));return JSON.stringify(t)}toDrawTools(){var t,e;if(!this.links)return void alert("nothing to export");const i=this.links.map(t=>({type:"polyline",latLngs:[t.origin.position,t.destination.position]}));null===(t=window.plugin.drawTools)||void 0===t||t.import(i),null===(e=window.plugin.drawTools)||void 0===e||e.save(),this.layer.clearLayers()}exportWalkPath(){var t,e;const i=[];for(let t=1;t<this.links.length;t++){const e=this.links[t-1].origin,s=this.links[t].origin;i.push({type:"polyline",latLngs:[e.position,s.position]})}null===(t=window.plugin.drawTools)||void 0===t||t.import(i),null===(e=window.plugin.drawTools)||void 0===e||e.save(),this.layer.clearLayers()}async toRESWUE(){const i=t.selectedOP();if(!i)return void alert("no operation active");if(!this.links)return void alert("nothing to export");const s=await(n=i,new Promise((t,i)=>{const s=`Export to ${n.name}`,o=e(n),a=dialog({title:s,html:o,resizable:!1,modal:!0});a.dialog("option","buttons",[{text:"OK",click:()=>{a.dialog("close"),t(r(a))}},{text:"Cancel",click:()=>{a.dialog("close"),t(void 0)}}]),a.dialog("moveToTop")}));var n;if(!s)return;const o=[s.layer],a=[...this.portals];this.links.forEach(t=>{a.push(t.origin,t.destination)});const l=a.filter((t,e)=>e===a.findIndex(e=>e.guid===t.guid)).filter(t=>void 0===i.portals.get(t.guid)).map(t=>i.portals.createNewPortal(t.guid,t.name,t.position,o));s.portalText&&l.forEach(t=>t.description=s.portalText);const h=this.links.map(t=>{const e=i.links.createNewLink(t.origin,t.destination,o);return e.description=t.comment,e.group=t.group,e}).filter(t=>!i.links.includes(t));let d=h[0].group,c=h[0].order||0;h.forEach(t=>{const e=t.group;e!==d&&(d=e,c=100*(Math.floor(c/100)+1)),t.order=c++}),await i.commitPortals({add:l}),await i.commitLinks({add:h}),this.layer.clearLayers()}reverseLinks(){let t=100;do{let e=0,i="";const s=new Map;if(this.links.forEach(t=>{var r;const n=(null!==(r=s.get(t.origin.guid))&&void 0!==r?r:0)+1;s.set(t.origin.guid,n),n>e&&(e=n,i=t.origin.guid)}),e<=8)return;const r=this.getIndexOfAll(i),n=e-(8-Math.ceil(8*Math.random()));this.getSample(r,n).forEach(t=>{const e=this.links[t];[e.destination,e.origin]=[e.origin,e.destination]}),t--}while(t>0)}getIndexOfAll(t){return this.links.reduce((e,i,s)=>i.origin.guid===t?[...e,s]:e,[])}getSample(t,e){const i=[],s=[];let r=t.length;if(e>=r)return t;for(;e--;){const n=Math.floor(Math.random()*r);i[e]=t[n in s?s[n]:n],s[n]=--r in s?s[r]:r}return i}sortLinks(){let t=this.findLinkWithoutOrder();for(;void 0!==t;)this.setOrder(t.origin,1),t=this.findLinkWithoutOrder();this.links.sort((t,e)=>t.order-e.order)}setOrder(t,e){this.links.filter(e=>e.origin===t).forEach(t=>{t.order||(t.order=e,this.setOrder(t.destination,e+1))})}findLinkWithoutOrder(){return this.links.find(t=>void 0===t.order)}}class d{constructor(t){this.positions=t.map(t=>L.latLng(t.lat,t.lng)),this.fullscanned=!1,this.portals=[],this.requiredTiles=this.getTiles(t)}getLatLngs(){return[...this.positions]}updatePosition(t){if(this.areSamePositions(t))return!1;const e=this.getTiles(this.positions),i=new Set;e.forEach(t=>{this.requiredTiles.has(t)||i.add(t)}),this.positions=t.map(t=>L.latLng(t.lat,t.lng)),this.fullscanned=!1,this.requiredTiles=this.getTiles(this.positions),i.forEach(t=>this.requiredTiles.delete(t)),this.fullscanned=0===this.requiredTiles.size;const s=this.portals;return this.portals=this.portals.filter(t=>this.isInPolygon(t.position)),s.length!==this.portals.length}areSamePositions(t){return t.length===this.positions.length&&this.positions.every((e,i)=>t[i].equals(e))}getTiles(t){const e=window.getMapZoomTileParameters(15),i=new Set,s=L.latLngBounds(t),r=window.lngToTile(s.getWest(),e),n=window.lngToTile(s.getEast(),e),o=window.latToTile(s.getNorth(),e),a=window.latToTile(s.getSouth(),e);for(let t=o;t<=a;t++)for(let s=r;s<=n;s++){const r=window.pointToTileId(e,s,t);i.add(r)}return i}getPortals(){return this.portals}testPortal(t){return!!this.isInPolygon(t.position)&&(this.addPortal(t),!0)}addPortal(t){return!this.portals.find(e=>e.guid===t.guid)&&(this.portals.push(t),!0)}testFullscanned(t){if(this.fullscanned)return!0;return[...this.requiredTiles.values()].forEach(t=>{window.mapDataRequest.cache.isFresh(t)&&this.requiredTiles.delete(t)}),this.fullscanned=0===this.requiredTiles.size,this.fullscanned}isFullscanned(){return this.fullscanned}isInPolygon(t){const e=this.positions,i=e.length;let s=!1;if(this.positions.some(e=>t.equals(e)))return!0;for(let r=0,n=i-1;r<i;n=r++)e[r].lat>t.lat!=e[n].lat>t.lat&&t.lng<e[r].lng+(e[n].lng-e[r].lng)*(t.lat-e[r].lat)/(e[n].lat-e[r].lat)&&(s=!s);return s}center(){const t=this.positions.reduce((t,e)=>[t[0]+e.lat,t[1]+e.lng],[0,0]);return L.latLng(t[0]/this.positions.length,t[1]/this.positions.length)}tileIDToLatLng(t){const e=/(?<zoom>[0-9]+)_(?<x>[0-9]+)_(?<y>[0-9]+)_(?<level>[0-9]+)_8_100/.exec(t).groups,i=window.getMapZoomTileParameters(parseInt(e.zoom)),s=window.tileToLng(parseInt(e.x),i),r=window.tileToLat(parseInt(e.y),i);return L.latLng(r,s)}getPosition(){if(this.isFullscanned()||0===this.requiredTiles.size)return this.center();const t=[...this.requiredTiles],e=t[Math.floor(Math.random()*t.length)];return this.tileIDToLatLng(e)}}const c=Math.PI/180;class u{static fromIITC(t){const e=window.portalDetail.get(t);if(e)return new u(t,e.title,L.latLng(1e-6*e.latE6,1e-6*e.lngE6));const i=window.portals[t];return i&&i.options.data.title?new u(i.options.guid,i.options.data.title,i.getLatLng()):void 0}static fromIITCPortal(t){if(t&&t.options.data.title)return new u(t.options.guid,t.options.data.title,t.getLatLng())}static isIITCDataAvailable(t){const e=window.portals[t];return void 0!==window.portalDetail.get(t)||e&&!!e.options.data.title}static fromJSON(t){if(t)return new u(t.guid,t.name,L.latLng(t.lat,t.lng))}toJSON(){return{guid:this.guid,name:this.name,lat:this.position.lat,lng:this.position.lng}}constructor(t,e,i){this.guid=t,this.name=e,this.position=i,this.description="",this.distance=0,this.sublayers=[],this.xyz=this.toCartesian(this.position)}toCartesian(t){const e=t.lat*c,i=t.lng*c,s=Math.cos(e);return[s*Math.cos(i),s*Math.sin(i),Math.sin(e)]}cross(t){const e=this.xyz,i=t.xyz;return[e[1]*i[2]-e[2]*i[1],e[2]*i[0]-e[0]*i[2],e[0]*i[1]-e[1]*i[0]]}dot(t){const e=this.xyz;return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}whichSideOfLine(t,e){const i=e.cross(t);return this.dot(i)}getPointDistance(t){const e=this.position.lat-t.position.lat,i=this.position.lng-t.position.lng;return Math.hypot(e,i)}getPointDistance2(t){const e=this.position.lat-t.position.lat,i=this.position.lng-t.position.lng;return e*e+i*i}getPointDistance2LL(t){const e=this.position.lat-t.lat,i=this.position.lng-t.lng;return e*e+i*i}}class f{constructor(){this.all=[],this.scanActive=!1,this.onDrawToolUpdate=()=>{const t=this.updateDrawTools();this.scanAllPortals(t),this.iitcFinishedLoad()&&this.onMapDataRefreshEnd()},this.onPortalAdded=t=>{const e=u.fromIITCPortal(t.portal);e&&this.all.some(t=>!!t.isInPolygon(e.position)&&(t.addPortal(e),this.updateTimer||(this.updateTimer=window.setTimeout(()=>this.triggerUpdate(),100)),!0))},this.onMapDataRefreshEnd=()=>{let t=!1;const e=window.map.getBounds();this.all.forEach(i=>{const s=i.testFullscanned(e);t=t||s}),this.checkAutoscan(),t&&this.triggerUpdate()}}init(){window.addHook("pluginDrawTools",this.onDrawToolUpdate),this.onDrawToolUpdate()}destroy(){window.removeHook("pluginDrawTools",this.onDrawToolUpdate),this.onUpdate=void 0,this.disableAutocan()}count(){return this.all.length}get(t){if(t>=this.count())throw"index out of bounds";return this.all[t]}updateDrawTools(){if(!window.plugin.drawTools)return!1;let t=0,e=!1;for(const i in window.plugin.drawTools.drawnItems._layers){const s=window.plugin.drawTools.drawnItems._layers[i];if(s instanceof L.GeodesicPolygon){const i=s.getLatLngs();if(this.all.length>t){const s=this.all[t].updatePosition(i);e=e||s}else e=!0,this.all.push(new d(i));t++}}return this.all.length=t,this.checkAutoscan(),e}iitcFinishedLoad(){const t=window.mapDataRequest,e=t.queuedTiles&&0===Object.keys(t.queuedTiles).length,i=t.requestedTileCount-(t.successTileCount+t.failedTileCount+t.staleTileCount);return e&&0===i&&0===t.renderQueue.length&&0===window.failedRequestCount}allScanned(){return this.all.every(t=>t.isFullscanned())}scanAllPortals(t=!1){for(const e in window.portals){const i=u.fromIITC(e);i&&this.all.some(e=>{if(e.isInPolygon(i.position)){const s=e.addPortal(i);return t=t||s,!0}return!1})}t&&this.onUpdate&&this.onUpdate()}checkAutoscan(){this.allScanned()?this.disableAutocan():this.enableAutocan()}enableAutocan(){this.scanActive||(window.addHook("portalAdded",this.onPortalAdded),window.addHook("mapDataRefreshEnd",this.onMapDataRefreshEnd),this.scanActive=!0)}disableAutocan(){this.scanActive&&(setTimeout(()=>{window.removeHook("portalAdded",this.onPortalAdded),window.removeHook("mapDataRefreshEnd",this.onMapDataRefreshEnd)},0),this.scanActive=!1)}triggerUpdate(){this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=void 0),this.onUpdate&&this.onUpdate()}getAllPortals(){return this.all.reduce((t,e)=>t.concat(e.getPortals()),[])}filterPortals(t){var e;if(null===(e=window.plugin.drawTools)||void 0===e?void 0:e.drawnItems)for(const e in window.plugin.drawTools.drawnItems._layers){const i=window.plugin.drawTools.drawnItems._layers[e];i instanceof L.Marker&&(t=t.filter(t=>!t.position.equals(i.getLatLng())))}return t}getAllPortalsFiltered(){return this.filterPortals(this.getAllPortals())}findPolyIndex(t,e){for(const[i,s]of t.entries())if(s instanceof L.GeodesicPolygon&&--e<0)return i}swapPoly(t,e){var i;if(!window.plugin.drawTools)return;const s=window.plugin.drawTools.drawnItems,r=s.getLayers(),n=this.findPolyIndex(r,t),o=this.findPolyIndex(r,e);if(void 0===n||void 0===o)return;const a=r[n];r[n]=r[o],r[o]=a,s.clearLayers(),r.forEach(t=>s.addLayer(t)),null===(i=window.plugin.drawTools)||void 0===i||i.save();const l=this.all[t];this.all[t]=this.all[e],this.all[e]=l}}const p=new class{constructor(t){this.data={},this.key=t,this.load()}get(t){return this.data[t]}getSafe(t,e){const i=this.data[t];return void 0===i?e:i}set(t,e){this.data[t]!==e&&(this.data[t]=e,this.save())}remove(t){this.data[t]=void 0,this.save()}load(){this.data={};const t=window.localStorage.getItem(this.key);t&&(this.data=JSON.parse(t))}save(){window.localStorage.setItem(this.key,JSON.stringify(this.data))}}("iitcplugin-morefields"),g=(t,e,i,s)=>{const r=document.createElement("input");r.type="checkbox",r.id=t,r.addEventListener("click",s),r.checked=i;const n=document.createElement("label"),o=document.createTextNode(e);return n.append(r,o),n};class m{init(){}destroy(){}onPolygonUpdate(){}toggleProcessing(){}}class w extends m{constructor(){super(...arguments),this.title="-- Welcome --"}createContents(t){t.append(this.createSection(1,"More Field","A multilayer with one Base-Link and a anchor zone."),this.createSection(2,"Multi field","3 Anchor zones multilayer. Every zone gets multiple anchors"),this.createSection(3,"FanField","One method to build max-fields in a zone"),this.createSection(4,"LinkField","A FanField with multiple base portals. Made for flip or BB quick link fields"),this.createSection(5,"LinkStar","Create links to one Portal"),this.createSection(6,"Homogeneous","Experimental - Create a homogeneous field"),this.createSection(7,"Lazyfeet","Experimental - Maxfield with shortest path"))}createSection(t,e,i){return $("<p>").append($("<button>",{class:"sectionButton",text:e,click:()=>et.selectTab(t)}),$("<p>",{text:i}))}init(){$("#dialog-moreFields .exportbox").hide()}destroy(){$("#dialog-moreFields .exportbox").show()}}class y{constructor(){this.isFinished=!0,this.gotNewSolution=!0}destroy(){this.stopProcessing()}newSolutionFound(){this.gotNewSolution=!0}start(){this.isFinished=!1,this.gotNewSolution=!1,this.startProcessing()}startProcessing(){this.stopProcessing(),et.showProcess(0),this.timer=window.setTimeout(()=>this.step(),50)}stopProcessing(){this.timer&&(window.clearTimeout(this.timer),this.timer=void 0)}step(){this.timer=void 0;const t=Date.now()+100;do{this.isFinished=this.process()}while(Date.now()<t&&!this.isFinished);if(this.gotNewSolution&&this.onSolution&&(this.onSolution(),this.gotNewSolution=!1),this.isFinished)return et.hideProcess(),void(this.onFinished&&this.onFinished());et.showProcess(this.getProgress()),this.timer=window.setTimeout(()=>this.step(),100)}toggleProcessing(t=!1){this.timer?this.stopProcessing():this.isFinished?this.start():this.step()}isProcessing(){return void 0!==this.timer}}class b{constructor(){this.bestResult=[],this.curPermutation=0,this.curBase1=0}start(t,e={}){this.options=Object.assign({limitlinks:0,polygonPermutaions:!0,allPhases:!0},e),this.portals=t.map(t=>[...t]),this.bestCount=0,this.bestResult=[],this.curPermutation=0,this.curBase1=0,this.prepare()}prepare(){this.sortPortals(this.portals),this.calculateMaxReachablePortals(this.portals),this.permutations=[],this.options.polygonPermutaions?this.generatePermutation(this.portals,t=>this.permutations.push([...t])):this.permutations.push([...this.portals])}getProcess(){const t=this.permutations.reduce((t,e)=>t+e[0].length,0);let e=this.curBase1;for(let t=0;t<this.curPermutation;t++)e+=this.permutations[t][0].length;return e/t}step(){const t=Date.now()+100;do{const t=this.permutations[this.curPermutation],e=t[0][this.curBase1];if(t[1].forEach(i=>{const s=[...t],r=[[e],[i]];let n=2;const o=this.solve(e,i,s[2],this.maxLinksToGenerate(1,0));r.push(o);const a=o.length;n+=a;let l=[i,o.at(-1),e],h=[a+1,2,a],d=l.reduce((t,e,i)=>t+Math.min(s[i].length,e.maxRestPortals),0),c=this.options.allPhases?1e3:2;for(;d>0&&d+n>=this.bestCount;){const t=r.length,e=l[0],i=l[1],o=l[2];if(s[t%3]=this.portalCanidates(e,i,o,s[t%3]),s[t%3].length>0){const o=this.maxLinksToGenerate(h[0],h[1]),a=this.solve(e,i,s[t%3],o);r.push(a);const d=a.length;n+=d,h[0]+=d,h[1]+=d,l[2]=a.at(-1),h[2]=2}else r.push([]);if(c--,c<=0)break;l=[l[1],l[2],l[0]],h=[h[1],h[2],h[0]],d=l.reduce((t,e,i)=>t+Math.min(s[i].length,e.maxRestPortals),0)}if(n>this.bestCount||n===this.bestCount&&this.bestResult.length>r.length){for(this.bestCount=n;0===r.at(-1).length;)r.splice(-1);this.bestResult=[...r]}}),this.curBase1++,this.curBase1>=t[0].length&&(this.curBase1=0,this.curPermutation++,this.curPermutation>=this.permutations.length))return!0}while(Date.now()<t);return!1}maxLinksToGenerate(t,e){return this.options.limitlinks?this.options.limitlinks-Math.max(t,e):1e3}center(t){const e=t.reduce((t,e)=>[t[0]+e.lat,t[1]+e.lng],[0,0]);return L.latLng(e[0]/t.length,e[1]/t.length)}sortPortals(t){t[0].forEach(e=>e.distance=Math.abs(e.whichSideOfLine(t[1][0],t[2][0]))),t[1].forEach(e=>e.distance=Math.abs(e.whichSideOfLine(t[0][0],t[2][0]))),t[2].forEach(e=>e.distance=Math.abs(e.whichSideOfLine(t[0][0],t[1][0]))),t.forEach(t=>t.sort((t,e)=>t.distance-e.distance))}findMaxPortal(t,e,i){let s=i[0],r=0;return i.forEach(i=>{const n=[e[0]-t.xyz[0],e[1]-t.xyz[1],e[2]-t.xyz[2]],o=[i.xyz[0]-t.xyz[0],i.xyz[1]-t.xyz[1],i.xyz[2]-t.xyz[2]],a=Math.hypot(n[0],n[1],n[2]),l=Math.hypot(o[0],o[1],o[2]),h=Math.acos((n[0]*o[0]+n[1]*o[1]+n[2]*o[2])/(a*l));h>r&&(s=i,r=h)}),s}calculateMaxReachablePortals(t){const e=t.map(t=>this.center(t.map(t=>t.position))),i=this.center(e),s=this.toCartesian(i);t.forEach((e,i)=>e.forEach(r=>{const n=t[(i+1)%3],o=t[(i+2)%3],a=this.findMaxPortal(r,s,n),l=this.findMaxPortal(r,s,o),h=this.portalCanidates(a,l,r,e);r.maxRestPortals=h.length}))}toCartesian(t){const e=t.lat*Math.PI/180,i=t.lng*Math.PI/180,s=Math.cos(e);return[s*Math.cos(i),s*Math.sin(i),Math.sin(e)]}portalCanidates(t,e,i,s){e.whichSideOfLine(t,i)>0&&([t,e]=[e,t]);const r=i.cross(t),n=i.cross(e);return s.filter(t=>t.guid!==i.guid&&t.dot(r)>0&&t.dot(n)<0)}solve(t,e,i,s){e.whichSideOfLine(t,i[0])>0&&([t,e]=[e,t]);let r=[i[0]];return i.forEach((n,o)=>{let a=[],l=0;const h=n.cross(t),d=n.cross(e);for(let t=o-1;t>=0;t--){const e=i[t];if(e.sublayers.length>=a.length&&e.sublayers.length<s&&e.dot(h)<0&&e.dot(d)>0){const t=n.getPointDistance2(e);(e.sublayers.length>a.length||t<l)&&(a=e.sublayers,l=t)}}n.sublayers=[...a],n.sublayers.push(n),n.sublayers.length>r.length&&(r=n.sublayers)}),r}generatePermutation(t,e,i){if(1===(i=i||t.length))e(t);else for(let s=1;s<=i;s++)this.generatePermutation(t,e,i-1),i%2?[t[0],t[i-1]]=[t[i-1],t[0]]:[t[s-1],t[i-1]]=[t[i-1],t[s-1]]}render(t,e){t.clear();let i=0;const s=this.bestResult;s.length>0&&(t.addLink(s[0][0],s[1][0]),s.forEach((r,n)=>{if(n<2)return;const o=this.getLastPortalOfPoly(n-2,s),a=this.getLastPortalOfPoly(n-1,s);let l=n>2?this.getLastPortalOfPoly(n-3,s):void 0;r.forEach(s=>{t.addDblLink(s,o,a),l&&e&&(t.addLink(s,l),i+=2),l=s})})),t.fields=s.reduce((t,e)=>t+e.length,-2)+i}getLastPortalOfPoly(t,e){for(;0===e[t].length;)t-=3;return e[t].at(-1)}}const v={color:"#000",interactive:!1,clickable:!1};class k extends m{constructor(){super(...arguments),this.title="Multi Field",this.solver=new b,this.onPolygonUpdate=()=>{this.resetDialog(),this.updatePolygonsSelector(),this.updatePolygonStats(),this.generate()}}createContents(t){this.dialog=t;const e="<div>How multifield works:\n        <ol>\n        <li>create a base link from polygon A to B</li>\n        <li>create layers in C with this base</li>\n        <li>create layers in B by using A & last C as base</li>\n        <li>create layers in A by using last B & last C as base</li>\n        </ol>\n        Repeat step 2.-4. till no more layers can be created</div>",i=p.getSafe("1phase",!1),s=p.getSafe("reorder",!0),r=p.getSafe("limit",0),n=i||!s||0!==r,o=p.getSafe("mlBL",!1);t.append($("<div>",{class:"resultbox"}).toggleClass("withPolygonOrder",!s).append($("<div>").append($("<span>",{text:"Anchor 1:"}),$("<a>",{id:"portalTargets1",text:"(need polygon)",click:()=>this.onAnchorSelect(0)}),$("<button>",{class:"downarrow",click:()=>this.swapPoly(0,1)})),$("<div>").append($("<span>",{text:"Anchor 2:"}),$("<a>",{id:"portalTargets2",text:"(need polygon)",click:()=>this.onAnchorSelect(1)}),$("<button>",{class:"downarrow",click:()=>this.swapPoly(1,2)}),$("<button>",{class:"uparrow",click:()=>this.swapPoly(0,1)})),$("<div>").append($("<span>",{text:"Anchor 3:"}),$("<a>",{id:"portalTargets3",text:"(need polygon)",click:()=>this.onAnchorSelect(2)}),$("<button>",{class:"uparrow",click:()=>this.swapPoly(1,2)})),$("<div>",{id:"warning"}),$("<div>",{id:"polygonSelector",class:"polygonSelectorbox"}).append($("<span>",{text:"You can select which 3:"}),$("<br>"),$("<div>",{id:"selectPolygons"})),$("<div>",{id:"polygonSelectorWarning"}),$("<a>",{id:"showoptions",text:"Options",click:()=>this.showOptions()}).append($("<div>",{class:"myshowbutton"})).toggle(!n),$("<div>",{id:"options"}).append($("<a>",{class:"myhidebutton",click:()=>this.hideOptions()}),$("<input>",{type:"checkbox",id:"onephase",click:()=>this.generate()}).prop("checked",i),$("<label>",{for:"onephase",text:"Only 1 phase"}),$("<a>",{class:"quickhelpbutton",text:"?",click:()=>this.explain1Phase()}),$("<div>",{class:"messagepopup helpphase1",click:()=>this.explain1Phase(),html:e+"<strong>With only one phase it will stop after the first iteration.</strong><p>Each anchor will only have one portal with outgoing links.</p>"}),$("<br>"),$("<input>",{type:"checkbox",id:"fixedorder",click:()=>this.onFixedOrder()}).prop("checked",!s),$("<label>",{for:"fixedorder",text:"Keep polygon order"}),$("<a>",{class:"quickhelpbutton",text:"?",click:()=>this.explainFixedOrder()}),$("<div>",{class:"messagepopup helpfixedorder",click:()=>this.explainFixedOrder(),html:e+"<strong>Without a fixed polygon order multifield will try every possible polygon combination to obtain max field count.</strong><p>This way you control in which order the fields are build.</p>"}),$("<br>"),$("<select>",{id:"linklimit",change:()=>this.generate()}).append($("<option>",{text:"no limit",value:"0"}).prop("selected",0===r),$("<option>",{text:"8",value:"8"}).prop("selected",8===r),$("<option>",{text:"16",value:"16"}).prop("selected",16===r),$("<option>",{text:"24",value:"24"}).prop("selected",24===r),$("<option>",{text:"32",value:"32"}).prop("selected",32===r),$("<option>",{text:"40",value:"40"}).prop("selected",40===r)),$("<label>",{for:"linklimit",text:"max links per portal"})).toggle(n),$("<br>"),g("mlbacklinks","Include backlinks",o,()=>this.onBackLinks())))}init(){this.visualSelectedPoly=new L.LayerGroup,window.map.addLayer(this.visualSelectedPoly)}destroy(){et.hideProcess(),this.stopProcessing(),this.hideSelectedPolygons()}onAnchorSelect(t){const e=et.getPolygons().get(t);if(!e)return;const i=e.getPosition();window.map.setView(i,15)}updatePolygonsSelector(){const t=et.getPolygons();if(t.count()<=3)return p.set("MFPolygons",[0,1,2]),void $("#polygonSelector",this.dialog).hide();const e=p.getSafe("MFPolygons",[0,1,2]);$("#selectPolygons",this.dialog).text("");for(let i=0;i<t.count();i++)$("#selectPolygons").append($("<div>").append($("<input>",{type:"checkbox",id:`selPolRad_${i}`,name:"selectPolygonRadio",value:i,change:()=>this.selectPolygons()}).prop("checked",e.includes(i)),$("<label>",{for:`selPolRad_${i}`,text:` #${i+1}`})));$("#polygonSelector",this.dialog).show(),this.selectPolygons()}showSelectedPolygons(){this.visualSelectedPoly.clearLayers();const t=p.getSafe("MFPolygons",[0,1,2]),e=et.getPolygons();for(let i=0;i<3;i++){const s=L.geodesicPolygon(e.get(t[i]).getLatLngs(),v);this.visualSelectedPoly.addLayer(s)}}hideSelectedPolygons(){window.map.removeLayer(this.visualSelectedPoly),this.visualSelectedPoly=void 0}selectPolygons(){const t=[],e=[];if($("input[name=selectPolygonRadio]").each((i,s)=>{s.checked?t.push(i):e.push(i)}),t.length<3){const i=3-t.length;$("#polygonSelectorWarning",this.dialog).html(`Select 3 polygons, now using:<br> "Selected + first ${i} unselected polygons"`);for(let s=0;s<i;s++)t.push(e[s])}else t.length>3?($("#polygonSelectorWarning",this.dialog).html(`Selected ${t.length} polygons. First 3 selected will be used`),t.length=3):$("#polygonSelectorWarning",this.dialog).html("");p.set("MFPolygons",t),this.showSelectedPolygons(),this.updatePolygonStats(),this.generate()}updatePolygonStats(){const t=et.getPolygons(),e=p.getSafe("MFPolygons",[0,1,2]);t.count()<3?$("#warning",this.dialog).text("plz create 3 DrawTools polygon"):t.count()>3?$("#warning",this.dialog).text(`There are ${t.count()} polygons. only 3 will be used`):$("#warning",this.dialog).text("");const i=Math.min(3,t.count());for(let s=0;s<i;s++){const i=t.get(e[s]),r=`${i.getPortals().length} Portals ${i.isFullscanned()?"":"(incomplete)"}`;$(`#portalTargets${s+1}`,this.dialog).text(r)}for(let t=i;t<3;t++)$(`#portalTargets${t+1}`,this.dialog).text("(need polygon)")}onBackLinks(){const t=$("#mlbacklinks",this.dialog).is(":checked");p.set("mlBL",t);const e=et.getResult();this.solver.render(e,t),et.resultUpdate()}resetDialog(){$("#layersComment",this.dialog).text("");for(let t=1;t<4;t++)$(`#portalTargets${t}`,this.dialog).text("(need polygon)")}generate(){et.getResult().clear();const t=this.getOptions(),e=et.getPolygons();if(e.count()<3)return;const i=p.getSafe("MFPolygons",[0,1,2]);for(let t=0;t<3;t++)if(0===e.get(i[t]).getPortals().length)return;this.solver.start([e.get(i[0]).getPortals(),e.get(i[1]).getPortals(),e.get(i[2]).getPortals()],t),this.timer&&clearInterval(this.timer),this.step()}getOptions(){const t={limitlinks:parseInt($("#linklimit",this.dialog).val()),polygonPermutaions:!$("#fixedorder",this.dialog).is(":checked"),allPhases:!$("#onephase",this.dialog).is(":checked")};return p.set("1phase",!t.allPhases),p.set("reorder",t.polygonPermutaions),p.set("limit",t.limitlinks),t}step(){this.isfinished=this.solver.step(),this.renderResult(),this.timer=void 0,this.isfinished||(this.timer=window.setTimeout(()=>this.step(),100))}toggleProcessing(){this.timer?this.stopProcessing():this.isfinished||this.step()}stopProcessing(){clearInterval(this.timer),this.timer=void 0}renderResult(){const t=et.getResult(),e=this.solver.bestResult;if(this.isfinished)et.hideProcess();else{const t=this.solver.getProcess();et.showProcess(t)}if(e.reduce((t,e)=>t+e.length,-2)>t.fields){const e=p.getSafe("mlBL",!1);this.solver.render(t,e),et.resultUpdate()}}explain1Phase(){$(".helpphase1",this.dialog).toggle("slow")}onFixedOrder(){$(".resultbox",this.dialog).toggleClass("withPolygonOrder",$("#fixedorder",this.dialog).is(":checked")),this.generate()}explainFixedOrder(){$(".helpfixedorder",this.dialog).toggle("slow")}showOptions(){$("#showoptions",this.dialog).hide(),$("#options",this.dialog).show()}hideOptions(){$("#showoptions",this.dialog).show(),$("#options",this.dialog).hide()}swapPoly(t,e){et.getPolygons().swapPoly(t,e),this.onPolygonUpdate()}}class _{constructor(){this.basePortals=[void 0,void 0],this.portals=[]}init(){this.basePortals[0]=u.fromJSON(p.get("base1")),this.basePortals[1]=u.fromJSON(p.get("base2")),this.result=[[],[]]}hasBasePortals(){return void 0!==this.basePortals[0]&&void 0!==this.basePortals[1]&&this.basePortals[0].guid!==this.basePortals[1].guid}setBase(t,e){this.basePortals[t]=e,p.set(0===t?"base1":"base2",null==e?void 0:e.toJSON())}getBase(t){return this.basePortals[t]}getBases(){return this.basePortals}canGenerate(){return this.hasBasePortals()&&this.portals.length>0}getBasePos(){if(!this.hasBasePortals())throw new Error("missing portals");return[this.basePortals[0].position,this.basePortals[1].position]}solve(){let t=this.basePortals[0],e=this.basePortals[1];if(this.result=[[],[]],!this.canGenerate())return;e.whichSideOfLine(t,this.portals[0])<0&&([t,e]=[e,t]),this.portals.forEach(i=>i.distance=i.whichSideOfLine(t,e)),this.portals.sort((t,e)=>t.distance-e.distance);let i=this.portals.findIndex(t=>t.distance>=0);-1===i&&(i=this.portals.length);const s=this.portals.slice(0,i);s.reverse();const r=this.portals.slice(i);this.result=[this.findLayers(t,e,s),this.findLayers(e,t,r)]}getResult(){return this.result}findLayers(t,e,i){if(i.length<=0)return[];let s=[i[0]];return i.forEach((r,n)=>{let o=[],a=0;const l=r.cross(t),h=r.cross(e);for(let t=n-1;t>=0;t--){const e=i[t];if(e.sublayers.length>=o.length&&e.dot(l)>0&&e.dot(h)<0){const t=r.getPointDistance2(e);(e.sublayers.length>o.length||t<a)&&(o=e.sublayers,a=t)}}r.sublayers=[...o],r.sublayers.push(r),r.sublayers.length>s.length&&(s=r.sublayers)}),s}}const x="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 6.35 6.35'%3e%3cg transform='translate(0 -290.65)'%3e%3ccircle cx='3.175' cy='293.825' r='1.979' style='opacity:.9%3bfill:none%3bfill-opacity:1%3bstroke:%23fffc00%3bstroke-width:1%3bstroke-linecap:round%3bstroke-linejoin:round%3bstroke-miterlimit:4%3bstroke-dasharray:none%3bstroke-dashoffset:4.19999981%3bstroke-opacity:1%3bpaint-order:normal'/%3e%3cpath d='M3.175 290.868v5.914M.16 293.825h6.03' style='fill:none%3bfill-rule:evenodd%3bstroke:%23f20800%3bstroke-width:.5%3bstroke-linecap:butt%3bstroke-linejoin:miter%3bstroke-opacity:.70739549%3bstroke-miterlimit:4%3bstroke-dasharray:none'/%3e%3c/g%3e%3c/svg%3e";class S extends m{constructor(){super(...arguments),this.title="More Fields",this.solver=new _,this.onPolygonUpdate=()=>{const t=et.getPolygons().count(),e=et.getPolygons().getAllPortalsFiltered(),i=!et.getPolygons().allScanned();this.solver.portals=e;const s=`${t} Polygons with ${e.length}${i?" (portals may missing)":""}`;$("#anchor3",this.dialog).text(s),this.generate()}}createContents(t){this.dialog=t;const e=$("<button>",{text:"set A",title:"set base link portal A"}).on("click",()=>this.setPortal(0)),i=$("<button>",{text:"set B",title:"set base link portal B"}).on("click",()=>this.setPortal(1));t.append($("<div>").append(e,$("<span>",{id:"portal0",class:"portal"})),$("<div>").append(i,$("<span>",{id:"portal1",class:"portal"})),$("<span>",{id:"anchor3"}),$("<br>"),g("mfbacklinks","Include backlinks",p.getSafe("mfBL",!1),()=>this.onBackLinks()))}init(){this.editLayer=new L.LayerGroup,window.map.addLayer(this.editLayer),this.solver=new _,this.solver.init(),this.solver.getBases().forEach((t,e)=>{t&&$(`#portal${e}`,this.dialog).text(t.name)}),this.clearPortals()}destroy(){window.map.removeLayer(this.editLayer)}setPortal(t){if(!window.selectedPortal)return this.clearBase(t),void alert("Please select a portal");if(!u.isIITCDataAvailable(window.selectedPortal))return void alert("Please wait till portal data is loaded before click 'set'");const e=u.fromIITC(window.selectedPortal);this.solver.setBase(t,e),$(`#portal${t}`,this.dialog).text(e.name),this.redrawBasePortals(),this.generate()}onBackLinks(){p.set("mfBL",$("#mfbacklinks",this.dialog).is(":checked")),this.draw()}clearBase(t){this.solver.setBase(t,void 0),$(`#portal${t}`,this.dialog).text(""),this.redrawBasePortals()}clearPortals(){this.redrawBasePortals()}redrawBasePortals(){this.editLayer.clearLayers(),this.solver.getBases().forEach(t=>{t&&this.editLayer.addLayer(new L.Marker(t.position,{icon:L.icon({iconAnchor:L.point(16,16),iconSize:L.point(32,32),iconUrl:x,shadowUrl:void 0}),interactive:!1,clickable:!1}))})}generate(){this.solver.canGenerate()&&this.solver.solve(),this.draw()}draw(){const t=et.getResult();t.clear();const[e,i]=this.solver.getBases(),[s,r]=this.solver.getResult();if(!e||!i)return;const n=p.getSafe("mfBL",!1);t.addLink(e,i),this.createLinks(t,e,i,s,n),this.createLinks(t,e,i,r,n),t.fields=s.length+r.length,n&&(t.fields+=2*(Math.max(s.length-1,0)+Math.max(r.length-1,0))),et.resultUpdate()}createLinks(t,e,i,s,r){let n;s.forEach(s=>{t.addDblLink(s,e,i),n&&r&&t.addLink(s,n),n=s})}}const P=t=>{const e=[...t],i=[],s=A(e);E(s,e,!0);let r=1;for(;r<e.length-1;){e[r].whichSideOfLine(e[r-1],e[r+1])<0?r++:(i.push(e.splice(r,1)[0]),r--,r<1&&(r=1))}return{hull:e,rest:i}},A=t=>t.reduce((t,e,i,s)=>e.position.lng<s[t].position.lng?i:t,0),E=(t,e,i)=>{const s=i?1:-1,r=e.splice(t,1)[0];e.sort((t,e)=>t.whichSideOfLine(r,e)*s),e.splice(0,0,r)},C=(t,e,i,s)=>{if(t.position.equals(e.position))return!1;if(i.position.equals(s.position))return!1;if(t.position.equals(i.position))return e.position.equals(s.position);if(t.position.equals(s.position))return e.position.equals(i.position);if(e.position.equals(i.position))return t.position.equals(s.position);if(e.position.equals(s.position))return t.position.equals(i.position);if(Math.min(t.position.lng,e.position.lng)>Math.max(i.position.lng,s.position.lng))return!1;if(Math.max(t.position.lng,e.position.lng)<Math.min(i.position.lng,s.position.lng))return!1;const r=I(t.xyz,e.xyz),n=I(i.xyz,s.xyz),o=I(r,t.xyz),a=I(r,e.xyz),l=I(n,i.xyz),h=I(n,s.xyz),d=I(r,n),c=d[0]*d[0]+d[1]*d[1]+d[2]*d[2];if(c<1e-30){const t=i.dot(o),e=i.dot(a);if(t<0&&e>0||t>0&&e<0)return!0;const r=s.dot(o),n=s.dot(a);if(r<0&&n>0||r>0&&n<0)return!0;const d=i.dot(l),c=s.dot(h);return d<0&&c>0||d>0&&c<0}const u=1/Math.sqrt(c);d[0]*=u,d[1]*=u,d[2]*=u;const f=T(d,o),p=T(d,a),g=T(d,l),m=T(d,h);return f>0&&p<0&&g>0&&m<0||f<0&&p>0&&g<0&&m>0},I=(t,e)=>[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]],T=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],O=(t,e)=>{if(t.position.equals(e[0].position)||t.position.equals(e[1].position)||t.position.equals(e[2].position))return!1;const i=I(e[0].xyz,e[1].xyz),s=I(e[1].xyz,e[2].xyz),r=I(e[2].xyz,e[0].xyz),n=T(i,e[2].xyz),o=T(i,t.xyz)*n,a=T(s,t.xyz)*n,l=T(r,t.xyz)*n;return o>0&&a>0&&l>0};class F{constructor(){this.portals=[],this.links=[],this.startIndex=0,this.fields=0}setPortals(t){this.portals=t}solve(t,e){if(this.links=[],this.fields=0,0===this.portals.length)return;const i=P(this.portals).hull;this.portals.forEach(t=>t.isHull=!1),i.forEach(t=>t.isHull=!0);const s=this.portals.indexOf(i[this.startIndex%i.length]);this.sortByAngle(s,this.portals,t);let r=this.portals[0],n=t?1:-1;this.links.push({origin:this.portals[1],destination:r});let o=[this.portals[1]],a=[...this.portals];for(let t=2;t<a.length;t++){const i=a[t];this.links.push({origin:i,destination:r});const s=this.findAllLinkable(i,o,n);s.forEach(t=>{this.links.push({origin:i,destination:t})}),this.fields+=1+2*(s.length-1),i.isHull?(o=[i],e&&(o=[r],r=i,n=-n,a=a.slice(t),this.sortByAngle(0,a,n>0),t=0)):(o=o.filter(t=>!(s.indexOf(t)>0)),o.push(i))}}findAllLinkable(t,e,i){return e.filter((s,r)=>this.areAllOnOneSide(e,r+1,t,s,i))}areAllOnOneSide(t,e,i,s,r){for(let n=e;n<t.length;n++)if(t[n].whichSideOfLine(i,s)*r>0)return!1;return!0}sortByAngle(t,e,i){const s=i?1:-1,r=e.splice(t,1)[0];e.sort((t,e)=>t.whichSideOfLine(r,e)*s),e.splice(0,0,r)}isCrossingAny(t,e){return this.links.some(i=>C(t,e,i.origin,i.destination))}render(t){t.clear(),this.links.forEach(e=>{t.addLink(e.origin,e.destination)}),t.fields=this.fields}}class z extends m{constructor(){super(...arguments),this.title="Fan Field",this.onPolygonUpdate=()=>{const t=et.getPolygons().count(),e=et.getPolygons().getAllPortalsFiltered(),i=!et.getPolygons().allScanned();this.solver.setPortals(e);const s=`${t} Polygons with ${e.length}${i?" (portals may missing)":""}`;$("#portalTargets1",this.dialog).text(s),this.generate()}}createContents(t){this.dialog=t;const e=$("<button>",{text:"Change Center"}).on("click",()=>this.onChangeBase());t.append($("<span>",{text:"Portals:"}),$("<a>",{id:"portalTargets1",text:"(need polygon)",click:()=>this.onAnchorSelect()}),$("<p>").append(e,$("<br>"),g("clockwise","Clockwise",!0,()=>this.onOptionChanged()),$("<br>"),g("movingbase","Moving Base Portal",!0,()=>this.onOptionChanged())))}init(){this.solver=new F}destroy(){}onAnchorSelect(){const t=et.getPolygons();let e=t.all.find(t=>!t.isFullscanned());if(e||(e=t.get(0)),!e)return;const i=e.getPosition();window.map.setView(i,15)}onChangeBase(){this.solver.startIndex++,this.generate()}onOptionChanged(){this.generate()}generate(){const t=et.getResult(),e=$("#clockwise").is(":checked"),i=$("#movingbase").is(":checked");this.solver.solve(e,i),this.solver.render(t),et.resultUpdate(),t.showKeys()}}class B{constructor(t,e){this.data=t,this.pick=e,this.current=[],this.currentIndex=[],this.index=0;for(let t=0;t<e;t++)this.currentIndex[t]=t,this.current[t]=this.data[t];this.numberOfCombinations=this.choose(this.data.length,this.pick)}getCount(){return this.numberOfCombinations}getIndex(){return this.index}next(){const t=this.data.length;if(this.currentIndex[0]>=t-this.pick)return;let e=this.pick-1;for(;e>0&&this.currentIndex[e]===t-this.pick+e;)e--;for(this.currentIndex[e]++,this.current[e]=this.data[this.currentIndex[e]],e+=1;e<this.pick;e++)this.currentIndex[e]=this.currentIndex[e-1]+1,this.current[e]=this.data[this.currentIndex[e]];return this.index++,this.current}skipToNext(t){for(t++;t<this.pick;t++)this.currentIndex[t]=this.data.length-this.pick+t}getCurrent(){return[...this.current]}getCombination(t){t=Math.min(t,this.numberOfCombinations-1);const e=this.data.length;let i=e,s=this.pick,r=this.choose(i,s)-1-t;const n=[];for(let t=0;t<this.pick;++t)n[t]=this.largestV(i,s,r),r-=this.choose(n[t],s),i=n[t],s-=1;return this.currentIndex=n.map(t=>e-1-t),this.current=this.currentIndex.map(t=>this.data[t]),this.index=t,this.current}largestV(t,e,i){let s=t-1;for(;this.choose(s,e)>i;)s--;return s}choose(t,e){if(t<e)return 0;if(t===e)return 1;let i=t-e,s=e;e>=t-e&&([i,s]=[s,i]);let r=i+1;for(let t=2;t<=s;++t)r=r*(i+t)/t;return r}}class R extends y{startSolving(t,e,i){this.init(t,e,i),this.start()}init(t,e,i){this.origins=[...t],this.targets=[...e],this.maxLinks=i,this.startOriginCount=this.origins.length,this.resultOrigins=[],this.resultTargets=[],this.bestOriginCount=0,this.bestTargetSize=0,this.sortOrigins()}sortOrigins(){const t=this.origins.reduce((t,e)=>[t[0]+e.position.lat,t[1]+e.position.lng],[0,0]);t[0]/=this.origins.length,t[1]/=this.origins.length;const e=e=>{const i=e.position.lat-t[0],s=e.position.lng-t[1];return i*i+s*s};this.origins.sort((t,i)=>e(t)-e(i))}process(){const t=this.maxLinks-2,e=this.targets.length;if(0===this.origins.length)return!0;if(this.origins.length<this.bestOriginCount)return!0;this.sortByAngle(this.origins[0],this.targets);for(let i=0;i<e-t;i++)for(let s=i+t;s<e;s++){const e=this.targets.slice(i+1,s).filter(t=>t.whichSideOfLine(this.targets[i],this.targets[s])>0);if(e.length>=t){const r=[this.targets[i],...e,this.targets[s]],n=this.findMaxLinkable(r,this.origins);if(this.removeImpossible(e,n,this.bestOriginCount),e.length<t)continue;const o=new B(e,t);let a=1;o.getCount()>1e3&&(a=Math.floor(o.getCount()/1e3)-1);do{let e=!1;for(let i=0;i<t;i++){const t=o.currentIndex[i],s=o.currentIndex[i+1];if(n[t][s-t-1]<this.bestOriginCount){e=!0;break}}if(e){o.skipToNext(a);continue}const r=[this.targets[i],...o.current,this.targets[s]],l=this.findOrigins(r,this.origins);if(l.length>this.bestOriginCount)this.bestOriginCount=l.length,this.bestTargetSize=this.sizeOfCloud(r),this.resultOrigins=l,this.resultTargets=[...r],this.testIfSomeIsImpossible(n,this.bestOriginCount),this.newSolutionFound();else if(l.length===this.bestOriginCount){const t=this.sizeOfCloud(r);t<this.bestTargetSize&&(this.bestTargetSize=t,this.resultOrigins=l,this.resultTargets=[...r],this.newSolutionFound())}a>1&&o.getCombination(o.getIndex()+a)}while(o.next())}}return this.origins.splice(-1,1),!1}findMaxLinkable(t,e){const i=[];for(let s=0;s<t.length-1;s++){const r=[],n=t[s];for(let i=s+1;i<t.length;i++){const o=t[i].cross(n);r[i-s-1]=e.reduce((t,e)=>t+(e.dot(o)>=0?1:0),0)}i[s]=r}return i}removeImpossible(t,e,i){for(let s=0;s<t.length;s++){if(e[s+1].reduce((t,e)=>Math.max(e,t),0)<i){for(let t=0;t<s;t++)e[s+1].splice(s-t-1,1);t.splice(s,1),s--}}}testIfSomeIsImpossible(t,e){t.forEach((t,e)=>{t.reduce((t,e)=>Math.max(e,t),0)})}getProgress(){return(this.startOriginCount-this.origins.length)/this.startOriginCount}sortByAngle(t,e){e.sort((e,i)=>e.whichSideOfLine(t,i))}findOrigins(t,e){const i=[],s=[];for(let e=1;e<t.length;e++)i.push(t[e].cross(t[e-1])),s.push(t[e-1].cross(t[e]));return e.filter(t=>i.every(e=>t.dot(e)>=0)&&s.every(e=>t.dot(e)<=0))}render(t){t.clear(),this.resultOrigins.forEach(e=>t.addPortal(e));this.createFanFieldLinks(this.resultOrigins[0],this.resultTargets).forEach(e=>t.addLink(e.origin,e.destination,void 0,e.group)),t.fields=(2*(this.maxLinks-2)+1)*this.resultOrigins.length}createFanFieldLinks(t,e){const i=[],s=[];e.forEach((r,n)=>{i.push({origin:t,destination:r,group:0});for(let t=0;t<n;t++)this.isCrossingAnything(r,e[t],s)||this.isCrossingAnything(r,e[t],i)||s.push({origin:r,destination:e[t]})});const r=[],n=[];return e.reverse().forEach(e=>{n.includes(e)||(r.push({origin:t,destination:e,group:1}),n.push(e));s.filter(t=>t.origin===e).filter(t=>!n.includes(t.destination)).map(t=>t.destination).forEach(e=>{r.push({origin:t,destination:e}),n.push(e)})}),s.forEach(t=>t.group=0),r.forEach(t=>t.group=1),[...s,...r]}isCrossingAnything(t,e,i){return i.some(i=>C(t,e,i.origin,i.destination))}sizeOfCloud(t){const e=t.reduce((t,e)=>[t[0]+e.position.lat,t[1]+e.position.lng],[0,0]);e[0]/=t.length,e[1]/=t.length;return t.reduce((t,i)=>{const s=i.position.lat-e[0],r=i.position.lat-e[0];return t+s*s+r*r},0)/t.length}}class D extends m{constructor(){super(...arguments),this.title="Link Fields",this.onPolygonUpdate=()=>{const t=et.getPolygons(),e=Math.min(t.count(),2);for(let i=0;i<e;i++){const e=t.get(i),s=`${t.filterPortals(e.getPortals()).length} Portals ${e.isFullscanned()?"":"(incomplete)"}`;$(`#portalTargets${i+1}`,this.dialog).text(s)}for(let t=e;t<2;t++)$(`#portalTargets${t+1}`,this.dialog).text("(need polygon)");this.generate()}}init(){this.solver=new R,this.solver.onSolution=()=>this.onNewSolution(),this.solver.onFinished=()=>this.onFinished()}createContents(t){this.dialog=t,t.append($("<div>").append($("<span>",{text:"Targets:"}),$("<a>",{id:"portalTargets1",text:"(need polygon)",click:()=>this.onAnchorSelect(0)})),$("<div>").append($("<span>",{text:"Origins:"}),$("<a>",{id:"portalTargets2",text:"(need polygon)",click:()=>this.onAnchorSelect(1)})),$("<label>",{for:"sbuls",text:"SBuls"}),$("<select>",{id:"sbuls",change:()=>this.generate()}).append($("<option>",{text:"0",value:"0"}),$("<option>",{text:"1",value:"1"}),$("<option>",{text:"2",value:"2"}),$("<option>",{text:"3",value:"3"}),$("<option>",{text:"4",value:"4"})),$("<div>",{id:"errortext"}))}onAnchorSelect(t){const e=et.getPolygons().get(t);if(!e)return;const i=e.getPosition();window.map.setView(i,15)}generate(){et.getResult().clear(),$("#errortext",this.dialog).hide();const t=8+8*parseInt($("#sbuls",this.dialog).val()),e=et.getPolygons(),i=e.filterPortals(e.get(0).getPortals()),s=e.filterPortals(e.get(1).getPortals());this.solver.startSolving(s,i,t)}onNewSolution(){const t=et.getResult();this.solver.render(t),et.resultUpdate()}onFinished(){0===this.solver.resultOrigins.length?$("#errortext",this.dialog).text("no solution found. Need more target portals").show():$("#errortext",this.dialog).hide(),et.hideProcess()}}class M extends m{constructor(){super(...arguments),this.title="Link Star",this.targetPortal=void 0,this.onPolygonUpdate=()=>{const t=et.getPolygons().count(),e=!et.getPolygons().allScanned();this.portals=et.getPolygons().getAllPortalsFiltered().filter(t=>!this.targetPortal||t.guid!==this.targetPortal.guid);const i=`${t} Polygons with ${this.portals.length}${e?" (portals may missing)":""}`;$("#anchor3",this.dialog).text(i),this.draw()}}createContents(t){this.dialog=t;const e=$("<button>",{text:"set target"}).on("click",()=>this.setTargetPortal());t.append($("<div>").append(e,$("<span>",{id:"targetportal",class:"portal"})),$("<span>",{id:"anchor3"}),$("<br>"))}init(){this.editLayer=new L.LayerGroup,window.map.addLayer(this.editLayer),this.targetPortal=u.fromJSON(p.get("tp")),this.clearPortals()}destroy(){window.map.removeLayer(this.editLayer)}setTargetPortal(){if(!window.selectedPortal)return this.clearBase(),void alert("Please select a portal");u.isIITCDataAvailable(window.selectedPortal)?(this.targetPortal=u.fromIITC(window.selectedPortal),$("#targetportal",this.dialog).text(this.targetPortal.name),this.redrawBasePortals(),this.onPolygonUpdate()):alert("Please wait till portal data is loaded before click 'set'")}clearBase(){this.targetPortal=void 0,$("#targetportal",this.dialog).text(""),this.redrawBasePortals()}clearPortals(){this.redrawBasePortals()}redrawBasePortals(){this.editLayer.clearLayers(),this.targetPortal&&this.editLayer.addLayer(new L.Marker(this.targetPortal.position,{icon:L.icon({iconAnchor:L.point(16,16),iconSize:L.point(32,32),iconUrl:x,shadowUrl:void 0}),interactive:!1,clickable:!1}))}draw(){const t=et.getResult();t.clear(),this.targetPortal&&(this.portals.forEach(e=>{e.guid!==this.targetPortal.guid&&t.addLink(e,this.targetPortal)}),et.resultUpdate())}}const U={deep:0},N=[0,1,4,13,40,121,364,1093,3280];class j extends y{constructor(){super(...arguments),this.portals=[],this.splitPointPortals=[]}setPortals(t){this.portals=t}getPortals(){return this.portals}getHull(){return this.hull}startSolving(t){if(t<1)return this.status="wrong level",!1;if(this.portals.length<3)return this.status="not enough portals",!1;const e=P(this.portals);this.hull=e.hull,this.innerPortals=e.rest;const i=N[t-1]+3;return this.innerPortals.length+3<i||this.hull.length<3?(this.status=`not enough portals: req.: ${i} is: ${this.portals.length}`,!1):(this.hullBaseField=new B(this.hull,3),this.status="",this.baseField=void 0,this.targetDeep=t,this.start(),!0)}process(){const t=this.hullBaseField.current,e=this.allPortalsInside(t,this.innerPortals),i=this.findSolution({anchors:t,portals:e},this.targetDeep-1);return i!==U?(this.baseField=[t[0],t[1],t[2]],this.subFields=i,!0):!this.hullBaseField.next()}getProgress(){return this.hullBaseField.getIndex()/this.hullBaseField.getCount()}allPortalsInside(t,e){return e.filter(e=>e.whichSideOfLine(t[0],t[1])>0&&e.whichSideOfLine(t[1],t[2])>0&&e.whichSideOfLine(t[2],t[0])>0)}findSolution(t,e){if(0===t.portals.length)return U;const i=e>0?N[e]:1;if(t.portals.length<i)return U;if(this.sortPortals(t),1===i)return{center:t.portals[0],deep:1,childs:[U,U,U]};const s=e>0?N[e-1]:1;let r=U;return t.portals.some(i=>{const n=this.splitPortals(t,i);if(Math.min(...n.map(t=>t.portals.length))<s)return!1;const o={center:i,deep:2,childs:[U,U,U]};for(let t=0;t<3;t++){const i=this.findSolution(n[t],e-1);if(i===U)return!1;o.childs[t]=i}return r=o,!0}),r}sortPortals(t){const e=t.portals.reduce((t,e)=>[t[0]+e.position.lat,t[1]+e.position.lng],[0,0]),i=L.latLng(e[0]/t.portals.length,e[1]/t.portals.length),s=t=>{const e=t.position.lat-i.lat,s=t.position.lng-i.lng;return e*e+s*s};t.portals.sort((t,e)=>s(t)-s(e))}splitPortals(t,e){const i=[{anchors:[t.anchors[0],t.anchors[1],e],portals:[]},{anchors:[t.anchors[1],t.anchors[2],e],portals:[]},{anchors:[t.anchors[2],t.anchors[0],e],portals:[]}];return t.portals.forEach(s=>{s!==e&&(s.whichSideOfLine(t.anchors[0],e)>0?s.whichSideOfLine(t.anchors[2],e)>0?i[1].portals.push(s):i[2].portals.push(s):s.whichSideOfLine(t.anchors[1],e)>0?i[0].portals.push(s):i[1].portals.push(s))}),i}hasSolution(){return void 0!==this.baseField}render(t){if(t.clear(),t.fields=0,this.baseField){let e=[{origin:this.baseField[0],destination:this.baseField[1],comment:"A",group:1},{origin:this.baseField[1],destination:this.baseField[2],comment:"B",group:1},{origin:this.baseField[2],destination:this.baseField[0],comment:"C",group:1}];this.splitPointPortals=[],this.subFields.deep>0&&(e=[...e,...this.getSortedLinks(this.baseField,this.subFields,"",2)]),e.forEach(e=>t.addLink(e.origin,e.destination,e.comment)),this.splitPointPortals.forEach(e=>t.addPortal(e));const i=new Set;e.forEach(t=>{i.add(t.origin),i.add(t.destination)}),t.fields=i.size}}getSortedLinks(t,e,i,s){const r=this.getLinksOfSubField(t,e,i);if(0===r.length)return[];const n=this.sortLinks(t,t[0],r,s);return n||this.getSortedLinksSplitted(t,e,i,s+1)}getSortedLinksSplitted(t,e,i,s){if(0===e.deep)return[];let r=[{origin:e.center,destination:t[0],comment:i+".1"},{origin:e.center,destination:t[1],comment:i+".2"},{origin:e.center,destination:t[2],comment:i+".3"}];return e.deep<=1||(this.splitPointPortals.push(e.center),r=[...r,...this.getSortedLinks([t[0],t[1],e.center],e.childs[0],i+"1",s),...this.getSortedLinks([t[1],t[2],e.center],e.childs[1],i+"2",s),...this.getSortedLinks([t[2],t[0],e.center],e.childs[2],i+"3",s)]),r}getLinksOfSubField(t,e,i){if(0===e.deep)return[];let s=[{origin:t[0],destination:e.center,comment:i+".1"},{origin:t[1],destination:e.center,comment:i+".2"},{origin:t[2],destination:e.center,comment:i+".3"}];return e.deep<=1||(s=[...s,...this.getLinksOfSubField([t[0],t[1],e.center],e.childs[0],i+"1"),...this.getLinksOfSubField([t[1],t[2],e.center],e.childs[1],i+"2"),...this.getLinksOfSubField([t[2],t[0],e.center],e.childs[2],i+"3")]),s}sortLinks(t,e,i,s){const r=new Set;i.forEach(t=>{r.add(t.origin),r.add(t.destination)});const n=[...r];n.sort((t,i)=>e.getPointDistance2(t)-e.getPointDistance2(i));const o=new Set(t),a=[];if(!n.some(t=>{i.filter(e=>e.destination===t).forEach(t=>[t.destination,t.origin]=[t.origin,t.destination]);const e=i.filter(e=>e.origin===t).filter(t=>o.has(t.destination));return e.length>16||(i=i.filter(t=>!e.includes(t)),e.some((t,i)=>i>1&&e[i-1].comment.length<t.comment.length),e.forEach(t=>t.group=s),a.push(...e),o.add(t),!1)}))return a}dumpLinks(t){t.forEach((t,e)=>{})}dumpSolution(){this.baseField&&this.subFields.deep>0&&this.dumpSub(1,this.subFields)}dumpSub(t,e){if(0===e.deep)return;"                              ".slice(0,2*t);e.deep>1&&(this.dumpSub(t+1,e.childs[0]),this.dumpSub(t+1,e.childs[1]),this.dumpSub(t+1,e.childs[2]))}}class W extends m{constructor(){super(...arguments),this.title="Homogeneous",this.onPolygonUpdate=()=>{const t=et.getPolygons().count(),e=et.getPolygons().getAllPortalsFiltered(),i=!et.getPolygons().allScanned(),s=`${t} Polygons with ${e.length}${i?" (portals may missing)":""}`;$("#portalTargets1",this.dialog).text(s),this.generate()}}createContents(t){this.dialog=t,t.append($("<span>",{text:"Portals:"}),$("<a>",{id:"portalTargets1",text:"(need polygon)",click:()=>this.onAnchorSelect()}),$("<p>").append($("<select>",{id:"hflevel",change:()=>this.generate()}).append($("<option>",{text:"HF-2",value:2}),$("<option>",{text:"HF-3",value:3}),$("<option>",{text:"HF-4",value:4}),$("<option>",{text:"HF-5",value:5}),$("<option>",{text:"HF-6",value:6}),$("<option>",{text:"HF-7",value:7}),$("<option>",{text:"HF-8",value:8})),$("<br>"),g("rwportals","use RW-Portals",!1,()=>this.generate()),$("<br>"),g("findsmalles","Find smallest",!1,()=>this.generate()),$("<br>")),$("<p>",{id:"errortext"}))}init(){this.solver=new j,this.solver.onSolution=()=>this.renderResult(),this.solver.onFinished=()=>this.onFinished()}destroy(){}onAnchorSelect(){const t=et.getPolygons();let e=t.all.find(t=>!t.isFullscanned());if(e||(e=t.get(0)),!e)return;const i=e.getPosition();window.map.setView(i,15)}updatePortals(){let t=[];t=$("#rwportals",this.dialog).is(":checked")?this.getRESWUEPortals():et.getPolygons().getAllPortalsFiltered(),this.solver.setPortals(t)}getRESWUEPortals(){const e=t.selectedOP();return e?e.portals.all.map(t=>new u(t.id,t.name,t.position)):[]}generate(){this.updatePortals(),this.renderError("");et.getResult().clear(),this.firstRun=!0;const t=parseInt($("#hflevel",this.dialog).val());this.solver.startSolving(t)||this.renderError(this.solver.status)}renderResult(){const t=et.getResult();(this.firstRun||this.solver.hasSolution())&&(this.solver.render(t),et.resultUpdate())}onFinished(){this.renderResult(),this.firstRun=!1;const t=$("#findsmalles",this.dialog).is(":checked");if(this.solver.hasSolution()&&t){let t=this.solver.getPortals();const e=this.solver.getHull();t=t.filter(t=>!e.includes(t));const i=parseInt($("#hflevel",this.dialog).val());this.solver.setPortals(t),this.solver.startSolving(i)}else et.getResult().isEmpty()&&this.renderError("no possible solution")}renderError(t){$("#errortext",this.dialog).text(t)}}var Z;!function(t){t[t.ORIGIN_INFIELD=-1]="ORIGIN_INFIELD",t[t.TOO_MUCH_OUTGOING=-2]="TOO_MUCH_OUTGOING",t[t.CROSSLINK=-3]="CROSSLINK",t[t.LINK=0]="LINK",t[t.FIELD=1]="FIELD",t[t.DOUBLEFIELD=2]="DOUBLEFIELD"}(Z||(Z={}));class H{constructor(){this.linkPortals=new Map,this.links=[],this.fields=[]}clone(){const t=new H;return t.links=[...this.links],t.fields=[...this.fields],t}reset(){this.linkPortals.clear(),this.links.length=0,this.fields.length=0}getLinks(){return this.links}getFields(){return this.fields}add(t,e){const i=this.testLink(t,e);if(i!==Z.LINK)return i;const s=this.findFields(t,e);return s.forEach(i=>{i&&this.storeField([t,e,i])}),this.storeLink(t,e),1===s.length?Z.FIELD:2===s.length?Z.DOUBLEFIELD:i}testLink(t,e){const i=this.storePortal(t),s=Z.LINK;return i.coveredByField&&t.position.distanceTo(e.position)>500?Z.ORIGIN_INFIELD:i.outgoing>=40?Z.TOO_MUCH_OUTGOING:this.hasCrosslink(t,e)?Z.CROSSLINK:s}hasCrosslink(t,e){return this.links.some(i=>C(t,e,i[0],i[1]))}findFields(t,e){const i=[],s=this.linkPortals.get(e.guid);return s&&s.linkedTo.forEach(s=>{const r=this.linkPortals.get(s),n=this.linkPortals.get(t.guid);if((null==r?void 0:r.linkedTo.includes(t.guid))||(null==n?void 0:n.linkedTo.includes(s))){const r=this.linkPortals.get(s);i.every((s,n)=>{const o=[t,e,r];if(O(r,[t,e,s]))return!1;return!O(s,o)||(i[n]=r,!1)})&&i.push(r)}}),i.length>2&&(i.length=0),i}storeField(t){this.fields.push(t),this.linkPortals.forEach(e=>{e.coveredByField||(e.coveredByField=O(e,t))})}storeLink(t,e){this.links.push([t,e]);const i=this.storePortal(t);i.linkedTo.push(e.guid),i.outgoing++;this.storePortal(e).linkedTo.push(t.guid)}storePortal(t){let e=this.linkPortals.get(t.guid);if(!e){const i=this.fields.some(e=>O(t,e));e=t,e.outgoing=0,e.linkedTo=[],e.coveredByField=i,this.linkPortals.set(t.guid,e)}return e}}const G=(t,e)=>{const i=t.tau.get(e.guid),s=t.n.get(e.guid);return Math.pow(i,1)*Math.pow(s,5)};class q{constructor(t){this.antType=t}init(t,e=[]){this.nodes=t.map(i=>{const s=i;return s.n=new Map,s.tau=new Map,t.forEach(t=>{if(t.guid!==s.guid){s.tau.set(t.guid,1);let i=s.position.distanceTo(t.position);i+=200*e.filter(e=>C(s,t,e[0],e[1])).length,s.n.set(t.guid,1/i)}}),s}),this.length=1/0,this.useGlobalBest=10,this.generation=0}solve(t){for(this.length=1/0;t>0;t--)this.step()}step(){this.generation++;const t=this.createAntPath(),e=t.reduce((t,e)=>t.length<e.length?t:e,t[0]);e.optimize(),e.length<this.length&&(this.route=[...e.route],this.length=e.length,this.best=e.clone()),this.updatePheromons(e)}createAntPath(){if(this.nodes.length<160){const t=this.nodes.length;return[...Array(t)].map((t,e)=>{const i=new this.antType;return i.init(this.nodes,e),i.walk(),i})}return this.sample(this.nodes.length,160).map(t=>{const e=new this.antType;return e.init(this.nodes,t),e.walk(),e})}sample(t,e){const i=Array(t).map((t,e)=>e);if(e>t)return i;const s=[];let r=i.length;for(;e>0;e--){const t=Math.floor(Math.random()*r);s.push(i[t]),r--,i[t]=i[r]}return s}updatePheromons(t){this.nodes.forEach(t=>{t.tau.forEach((e,i)=>{t.tau.set(i,.8*e)})}),this.useGlobalBest--<0?(this.useGlobalBest=10,this.addPheromons(this.route,this.length)):this.addPheromons(t.route,t.length);const e=1/((1-.8)*this.length),i=this.nodes.length/2,s=Math.pow(.05,1/this.nodes.length),r=Math.min(e,e*(1-s)/((i-1)*s));this.nodes.forEach(t=>{t.tau.forEach((i,s)=>{i<r&&t.tau.set(s,r),i>e&&t.tau.set(s,e)})})}addPheromons(t,e){const i=1/e;for(let e=0;e<t.length;e++){let s=t[e],r=t[(e+1)%t.length];const n=s.tau.get(r.guid)+i;s.tau.set(r.guid,n),r.tau.set(s.guid,n)}}routeChangeStart(t){const e=this.route.findIndex(e=>e.guid===t);this.route=[...this.route.slice(e),...this.route.slice(0,e)]}routeReverse(){this.route.reverse(),this.route=[...this.route.slice(-1),...this.route.slice(0,-1)]}getLambdaFactor(t){let e=0;return this.nodes.forEach(i=>{const s=Math.min(...i.tau.values()),r=Math.max(...i.tau.values()),n=s+t*(r-s);i.lambdaFactor=[...i.tau.values()].reduce((t,e)=>e>n?t+1:t,0),e+=i.lambdaFactor}),e/this.nodes.length}}class K{init(t,e){this.notVisited=[...t],this.length=0,this.pickStart(e)}clone(){const t=new K;return t.route=[...this.route],t.length=this.length,t.notVisited=[...this.notVisited],t}pickStart(t){this.route=this.notVisited.splice(t,1)}walk(){const t=this.route.at(-1);let e=t;for(;this.notVisited.length>0;){const t=this.getNextNode(e,this.notVisited),i=this.notVisited.splice(t,1)[0];this.route.push(i),this.addNode(e,i),e=i}this.length+=this.getDistance(e,t)}addNode(t,e){this.length+=this.getDistance(t,e)}getNextNode(t,e){const i=e.reduce((e,i)=>e+this.getEdgeProbability(t,i),0);let s=Math.random()*i,r=-1;do{r++,s-=this.getEdgeProbability(t,e[r])}while(s>0);return r}getEdgeProbability(t,e){return Math.pow(t.tau.get(e.guid),1)*Math.pow(t.n.get(e.guid),5)}getDistance(t,e){return 1/t.n.get(e.guid)}optimize(){for(let t=2;t<this.route.length;t++){const e=this.route[t-2].position,i=this.route[t-1].position,s=this.route[t].position,r=this.route[(t+1)%this.route.length].position,n=e.distanceTo(i)+s.distanceTo(r),o=e.distanceTo(s)+i.distanceTo(r);n>o&&([this.route[t-1],this.route[t]]=[this.route[t],this.route[t-1]],this.length+=o-n)}}}const V=new class{constructor(){this.maxFieldLinks=[]}build(t){const e=P(t);this.maxFieldLinks=[],this.splitHull(e)}getLinksOfPortal(t){return{incoming:this.maxFieldLinks.filter(e=>e[1].guid===t).map(t=>[t[1],t[0],t[2]]),outgoing:this.maxFieldLinks.filter(e=>e[0].guid===t)}}getLinks(){return this.maxFieldLinks}splitHull(t){this.findBestSplitTriangles(t).forEach(t=>{const e={hull:[t[0],t[1],t[2]],rest:t[3]};this.processTriangle(e,1)})}findBestSplitTriangles(t){const e=this.generateTriangulations(t);let i=1/0;return e.reduce((t,e)=>{const s=new Map;e.forEach(t=>{var e;const i=t[3].length;for(let r=0;r<3;r++){const n=t[r];s.set(n.guid,(null!==(e=s.get(n.guid))&&void 0!==e?e:0)+i)}});const r=[...s.values()].reduce((t,e)=>t+e*e,0);return r<i?(i=r,e):t},e[0])}generateTriangulations(t){const e=t.hull,i=e.length;if(i<3)return[];const s=Array.from({length:i},()=>Array.from({length:i}));for(let t=0;t<i;t++)for(let e=0;e<i;e++)(e-t<2||e<t&&i+e-t<2)&&(s[t][e]=[[]]);for(let r=2;r<i;r++)for(let n=0;n+r<i;n++){const i=n+r;s[n][i]=[];for(let r=n+1;r!==i;r++){const o=s[n][r],a=s[r][i],l=[e[n],e[r],e[i],[]];l[3]=t.rest.filter(t=>O(t,l));for(const t of o)for(const e of a)s[n][i].push([...t,...e,l])}}return s[0][i-1]}processTriangle(t,e){if(this.maxFieldLinks.push([t.hull[0],t.hull[1],e],[t.hull[1],t.hull[2],e],[t.hull[2],t.hull[0],e]),0===t.rest.length)return;if(1===t.rest.length)return void this.maxFieldLinks.push([t.hull[0],t.rest[0],e+1],[t.hull[1],t.rest[0],e+1],[t.hull[2],t.rest[0],e+1]);let i,s,r=1/0;t.rest.forEach(e=>{const n=this.splitTriangle(t.hull,e,t.rest),o=this.balanceRate(n);o<r&&(i=n,r=o,s=e)}),this.processTriangle({hull:[t.hull[0],t.hull[1],s],rest:i[0]},e+2),this.processTriangle({hull:[t.hull[1],t.hull[2],s],rest:i[1]},e+2),this.processTriangle({hull:[t.hull[2],t.hull[0],s],rest:i[2]},e+2)}splitTriangle(t,e,i){const s=[[],[],[]],r=e.cross(t[0]),n=e.cross(t[1]),o=e.cross(t[2]);return i.forEach(t=>{e!==t&&(t.dot(r)>0?t.dot(o)>0?s[1].push(t):s[2].push(t):t.dot(n)>0?s[0].push(t):s[1].push(t))}),s}balanceRate(t){const e=t[0].length,i=t[1].length,s=t[2].length,r=(e+i+s)/3,n=e-r,o=i-r,a=s-r;return Math.hypot(n,o,a)}};class J extends K{init(t,e){super.init(t,e),this.links=new H}clone(){const t=super.clone();return t.links=this.links.clone(),t}addNode(t,e){super.addNode(t,e);const i=this.getLinksTargetsOf(e).filter(t=>this.notVisited.every(e=>t.guid!==e.guid));i.some(t=>this.links.testLink(e,t)!==Z.LINK)&&(this.length+=1e6),i.forEach(t=>this.links.add(e,t))}getLinksTargetsOf(t){const{incoming:e,outgoing:i}=V.getLinksOfPortal(t.guid);return[...e,...i].sort((e,i)=>{let s=e[2]-i[2];if(0===s){s=e[0].position.distanceTo(t.position)-i[0].position.distanceTo(t.position)}return s}).map(t=>t[1])}}class Y extends y{constructor(){super(),this.tsp=new q(J),this.links=new H,this.startPortalIndex=0}destroy(){super.destroy(),this.tsplayer&&(window.removeLayerGroup(this.tsplayer),this.tsplayer=void 0),this.maxFieldlayer&&(window.removeLayerGroup(this.maxFieldlayer),this.maxFieldlayer=void 0)}startSolving(t,e){this.tsp.init(t,e),this.bestRouteLength=1/0,V.build(t),this.start()}process(){return this.tsp.generation>100||(this.tsp.step(),this.bestRouteLength>this.tsp.length&&(this.bestRouteLength=this.tsp.length,this.createLinks(this.tsp.route),this.onSolution&&this.onSolution()),!1)}createLinks(t){this.links.reset();const e=P(this.tsp.route),i=this.startPortalIndex%e.hull.length;this.tsp.routeChangeStart(e.hull[i].guid);for(let t=1;t<this.tsp.route.length;t++){const e=this.tsp.route[t];this.getLinksTargetsOf(e).forEach(i=>{this.tsp.route.findIndex(t=>t.guid===i.guid)<t&&this.links.add(e,i)})}}getLinksTargetsOf(t){const{incoming:e,outgoing:i}=V.getLinksOfPortal(t.guid);return[...e,...i].sort((e,i)=>{let s=e[2]-i[2];if(0===s){s=e[0].position.distanceTo(t.position)-i[0].position.distanceTo(t.position)}return s}).map(t=>t[1])}getProgress(){return this.tsp.generation/100}render(t){t.clear(),this.links.getLinks().forEach(e=>t.addLink(e[0],e[1])),t.fields=this.links.getFields().length}getFields(){return this.links.getFields().length}getLength(){return this.bestRouteLength||0}renderTSPPath(){this.tsplayer||(this.tsplayer=L.layerGroup(),window.addLayerGroup("TSP",this.tsplayer,!0)),this.tsplayer.clearLayers(),this.tsp.nodes.forEach((t,e)=>{const i=this.tsp.nodes.reduce((e,i)=>e+(t.guid!==i.guid?G(t,i):0),0);this.tsp.nodes.forEach(e=>{if(t.guid<e.guid){const s=this.isInRoute(t,e,this.tsp.route),r=G(t,e)/i;if(r>.1||s){const i=L.geodesicPolyline([t.position,e.position],{weight:Math.max(16*r,1),color:s?"#55e":"#773",dashArray:s?void 0:"8 8"});this.tsplayer.addLayer(i)}}})})}isInRoute(t,e,i){return i.some((s,r)=>{const n=(r+1)%i.length;return s.guid===t.guid&&i[n].guid===e.guid||s.guid===e.guid&&i[n].guid===t.guid})}renderMaxField(){this.maxFieldlayer||(this.maxFieldlayer=L.layerGroup(),window.addLayerGroup("MaxFields",this.maxFieldlayer,!0)),this.maxFieldlayer.clearLayers(),V.getLinks().forEach(t=>{const e=L.geodesicPolyline([t[0].position,t[1].position],{weight:2,color:"#773"});this.maxFieldlayer.addLayer(e)})}changeStart(){this.startPortalIndex++,this.createLinks(this.tsp.route),this.onSolution&&this.onSolution()}reversePath(){this.tsp.route.reverse(),this.createLinks(this.tsp.route),this.onSolution&&this.onSolution()}}class X extends m{constructor(){super(...arguments),this.title="Lazy Feet",this.onPolygonUpdate=()=>{this.resetDialog();const t=et.getPolygons();if(0===t.count())return;const e=t.getAllPortalsFiltered(),i=`${e.length} Portals ${t.allScanned()?"":"(incomplete)"}`;$("#portals",this.dialog).text(i),e.length>0&&this.generate(e)}}init(){this.solver=new Y,this.solver.onSolution=()=>this.onNewSolution(),this.solver.onFinished=()=>this.onFinished()}createContents(t){this.dialog=t,t.append($("<div>").append($("<span>",{text:"Portals:"}),$("<a>",{id:"portals",text:"(need polygon)",click:()=>this.onPolygonClick()}),$("<div>",{id:"lfinfo",text:""}),$("<button>",{id:"changenStart",text:"Change Start",click:()=>this.changeStart()}),$("<br>"),$("<button>",{id:"reverse",text:"Reverse Route",click:()=>this.changeOrder()})))}destroy(){this.solver.destroy(),et.hideProcess()}onPolygonClick(){const t=et.getPolygons().get(0);if(!t)return;const e=t.getPosition();window.map.setView(e,15)}getBlockLinks(){if(!window.plugin.drawTools)return[];const t=[];for(const e in window.plugin.drawTools.drawnItems._layers){const i=window.plugin.drawTools.drawnItems._layers[e];if(i instanceof L.GeodesicPolyline){const e=i.getLatLngs();for(let i=0;i<e.length-1;i++)t.push([new u("","",e[i]),new u("","",e[i+1])])}}return t}resetDialog(){$("#portals",this.dialog).text("(need polygon)")}generate(t){et.getResult().clear();const e=this.getBlockLinks();this.solver.startSolving(t,e),this.updateButton()}onNewSolution(){const t=et.getResult();this.solver.render(t),t.showKeys(),this.updateInfo(),et.resultUpdate()}onFinished(){et.hideProcess(),this.updateButton()}updateInfo(){const t=et.getPolygons();if(0===t.count())return;const e=t.getAllPortalsFiltered();if(e.length<3)return void $("#lfinfo",this.dialog).html("");const i=P(e).hull.length,s=3*e.length-2*i-2,r=this.solver.getFields(),n=`Fields: ${r} of ${s} (${(r/s*100).toFixed(0)}%)<br>Way: ${this.solver.getLength().toFixed(0)}m`;$("#lfinfo",this.dialog).html(n)}toggleSolver(){this.solver.toggleProcessing(!0),this.updateButton()}updateButton(){const t=this.solver.isProcessing()?"Stop":"Start";$("#runner",this.dialog).text(t)}changeStart(){this.solver.changeStart(),this.updateInfo(),et.resultUpdate()}changeOrder(){this.solver.reversePath(),this.updateInfo(),et.resultUpdate()}}class Q{constructor(){this.alerts=[]}findAlerts(t){let e=[...t],i=this.getPortalsWithMaxLinks(e);for(;i.length>0;)this.filterSameLinks(i,e),i.forEach(t=>{this.alerts.push(t),e=e.filter(e=>e.origin.guid!==t.portal.guid&&e.destination.guid!==t.portal.guid)}),i=this.getPortalsWithMaxLinks(e);return this.processSingleLinks(e),this.alerts}getPortalsWithMaxLinks(t){const e=new Map;let i=1,s=[];const r=(t,r)=>{var n;const o=(null!==(n=e.get(t.guid))&&void 0!==n?n:0)+1;e.set(t.guid,o),o>i&&(i=o,s=[]),o===i&&s.push({portal:t,team:r.team})};return t.forEach(t=>{r(t.origin,t),r(t.destination,t)}),s}filterSameLinks(t,e){for(let i=0;i<t.length-1;i++){const s=t[i];for(let r=i+1;r<t.length;r++){const n=t[i];if(e.some(t=>t.origin.guid===s.portal.guid&&t.destination.guid===n.portal.guid||t.origin.guid===n.portal.guid&&t.destination.guid===s.portal.guid)){t.splice(r,1),i--;break}}}}processSingleLinks(t){t.forEach(t=>{this.alerts.push({portal:t.origin,team:t.team})})}}class tt{constructor(){this.links=[],this.blockers=new Map,this.isActive=!1,this.onNewLink=t=>{const e=t.link;this.testLink(e)}}setLinks(t){this.links=t,this.recheckBlockers(),this.links.length>0&&(this.scanScreen(),this.startWatching())}setResultLinks(t){const e=t.getLinks().map(t=>({origin:new u(t.origin.guid,"",t.origin.position),destination:new u(t.destination.guid,"",t.destination.position),team:1}));this.setLinks(e)}recheckBlockers(){this.blockers=new Map([...this.blockers.entries()].filter(([t,e])=>this.links.some(t=>C(t.origin,t.destination,e.origin,e.destination))))}scanScreen(){Object.values(window.links).forEach(t=>this.testLink(t))}testLink(t){const e=t.getLatLngs(),i=new u(t.options.data.oGuid,"",e[0]),s=new u(t.options.data.dGuid,"",e[1]);this.links.some(t=>C(t.origin,t.destination,i,s))&&(this.blockers.has(t.options.guid)||(this.blockers.set(t.options.guid,{origin:i,destination:s,team:t.options.team}),this.onNewBlocker()))}startWatching(){this.isActive||(this.isActive=!0,window.addHook("linkAdded",this.onNewLink))}stopWatching(){this.isActive&&(this.isActive=!1,window.removeHook("linkAdded",this.onNewLink),window.clearTimeout(this.callbackTimer))}getAlerts(){return(new Q).findAlerts([...this.blockers.values()])}getAlertFactions(){const t=[0,0,0,0];return this.getAlerts().forEach(e=>t[e.team]++),t[0]=t[1]+t[2]+t[3],t}setOnNewBlocker(t){this.newBlockerCallBack=t}onNewBlocker(){this.newBlockerCallBack&&(window.clearTimeout(this.callbackTimer),this.callbackTimer=window.setTimeout(()=>{this.newBlockerCallBack&&this.newBlockerCallBack()},300))}}const et=new class{constructor(){this.resultRender=new h,this.polygons=new f,this.blockerWatch=new tt}init(){i(768);const t=$("<a/>",{text:"MoreFields2",click:()=>this.showDialog()});$("#toolbox").append(t),this.registerRESWUE(),this.pages=new Map([[0,new w],[1,new S],[2,new k],[3,new z],[4,new D],[5,new M],[6,new W],[7,new X]])}registerRESWUE(){return!!t.requiredVersion("2.7.0")&&(t.registerAddon({name:"More Fields",action:()=>this.showDialog()}),!0)}showDialog(){const t=p.getSafe("ShowKeys",!1),e=p.getSafe("ShowOrder",!1),i=p.getSafe("ShowPath",!1),s=$("<select>",{id:"pages",change:t=>this.selectTab(parseInt($(t.target).val()))});this.pages.forEach((t,e)=>{s.append($("<option>",{value:e,text:t.title}))});const r=$("<div>").append(s,$("<div>",{class:"tabcontainer"}),$("<div>",{class:"exportbox"}).append($("<div>",{class:"resultbox"}).append($("<div>",{id:"alerts"}),$("<div>",{id:"fieldsfound"}),$("<div>",{class:"mfprocessbar",click:()=>this.toggleProcessing(),title:"click to pause"}).append($("<span>",{class:"mftext"}),$("<span>",{class:"mfbar"}))),$("<p>").append("Order:",g("orderpath","Path",i,()=>this.onShowOrder()),g("showorder","Numbers",e,()=>this.onShowOrder())).css("white-space","nowrap"),$("<p>").append("Keys:",g("showkeys","Show",t,()=>this.onShowKeys()),$("<div>",{id:"keylist"}),$("<div>",{id:"sbulslist_block",hidden:!0}).append("SBULs:",$("<span>",{id:"sbulslist"}))).css("margin-bottom","6px"),$("<button>",{text:"export to drawtools"}).on("click",()=>this.toDrawTools()),$("<input>",{id:"drawscript",class:"copyfield",readonly:!0}).on("focus",()=>this.onCopyFieldFocus()).on("click",()=>this.onCopyFieldFocus()),$("<br>"),$("<button>",{text:"export to RESWUE"}).on("click",()=>this.toRESWUE())));let n;"undefined"!=typeof android&&android&&(n={my:"center top",at:"center top"}),this.dialog=dialog({id:"moreFields",title:"RW - More Fields",html:r,position:n,closeCallback:()=>this.destroy()}),this.polygons.init(),this.resultRender.init(),this.blockerWatch.setOnNewBlocker(()=>this.updateAlertStats()),this.resultUpdate(),this.selectTab(p.getSafe("tab",0))}destroy(){this.currentTab&&(this.currentTab.destroy(),this.currentTab=void 0),this.blockerWatch.stopWatching(),this.polygons.destroy(),this.resultRender.destroy()}selectTab(t){p.set("tab",t),$("#pages",this.dialog).val(t),this.currentTab&&(this.currentTab.destroy(),this.resultRender.clear(),this.resultUpdate()),this.currentTab=this.getTab(t);const e=$(".tabcontainer",this.dialog);e.empty(),this.currentTab.createContents(e),this.currentTab.init(),this.polygons.onUpdate=this.currentTab.onPolygonUpdate,this.currentTab.onPolygonUpdate()}getActiveTab(){return parseInt($(".tabs button.active").val())}getTab(t){return this.pages.get(t)||this.pages.get(0)}getResult(){return this.resultRender}resultUpdate(){const t={showKeys:$("#showkeys",this.dialog).is(":checked"),showOrder:$("#showorder",this.dialog).is(":checked"),showPath:$("#orderpath",this.dialog).is(":checked")};this.resultRender.render(t),$("#fieldsfound",this.dialog).text(`Fields: ${this.resultRender.fields}`);const e=this.resultRender.toDrawToolsString();$("#drawscript",this.dialog).val(e),this.updateAlertStats()}updateAlertStats(){this.blockerWatch.setResultLinks(this.resultRender);const t=this.blockerWatch.getAlertFactions();$("#alerts",this.dialog).empty(),0!==t[0]&&$("#alerts",this.dialog).append($("<span>",{class:"alertres",text:`RES: ${t[1]}`}).css("width",t[1]/t[0]*100),$("<span>",{class:"alertenl",text:`ENL: ${t[2]}`}).css("width",t[2]/t[0]*100),$("<span>",{class:"alertmac",text:`MAC: ${t[3]}`}).css("width",t[3]/t[0]*100))}onShowOrder(){p.set("ShowOrder",$("#showorder",this.dialog).is(":checked")),p.set("ShowPath",$("#orderpath",this.dialog).is(":checked")),this.resultUpdate()}onShowKeys(){p.set("ShowKeys",$("#showkeys",this.dialog).is(":checked")),this.resultUpdate()}hideProcess(){$(".mfprocessbar",this.dialog).hide()}showProcess(t){$(".mfprocessbar",this.dialog).show(),$(".mfprocessbar .mftext",this.dialog).text(Math.floor(1e3*t)/10+"%"),$(".mfprocessbar .mfbar",this.dialog).width(Math.floor(100*t)+"%")}toggleProcessing(){this.currentTab&&this.currentTab.toggleProcessing()}getPolygons(){return this.polygons}onCopyFieldFocus(){$(".copyfield",this.dialog).select()}toDrawTools(){this.resultRender.toDrawTools()}toRESWUE(){this.resultRender.toRESWUE()}};!function(t,e){const i=()=>{window.plugin[e]=t,window.plugin[e].init()};i.info=SCRIPT_INFO,window.bootPlugins||(window.bootPlugins=[]),window.bootPlugins.push(i),window.iitcLoaded&&i()}(et,"moreFields2")})()})();
 };
 (function () {
   const info = {};
   if (typeof GM_info !== 'undefined' && GM_info && GM_info.script)
     info.script = { version: GM_info.script.version, name: GM_info.script.name, description: GM_info.script.description };
   if (typeof unsafeWindow != 'undefined' || typeof GM_info == 'undefined' || GM_info.scriptHandler != 'Tampermonkey') {
     const script = document.createElement('script');
     script.appendChild(document.createTextNode( '('+ wrapper +')('+JSON.stringify(info)+');'));
     document.head.appendChild(script);} 
   else wrapper(info);
 })();